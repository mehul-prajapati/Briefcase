<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0051)https://help.ubuntu.com/community/SettingUpNFSHowTo -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="robots" content="index,nofollow">

<title>SettingUpNFSHowTo - Community Help Wiki</title>
<script type="text/javascript" src="./SettingUpNFSHowTo - Community Help Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="./SettingUpNFSHowTo - Community Help Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="./SettingUpNFSHowTo - Community Help Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="./SettingUpNFSHowTo - Community Help Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="./SettingUpNFSHowTo - Community Help Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://help.ubuntu.com/community/CommunityHelpWiki">
<link rel="Alternate" title="Wiki Markup" href="https://help.ubuntu.com/community/SettingUpNFSHowTo?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://help.ubuntu.com/community/SettingUpNFSHowTo?action=print">
<link rel="Search" href="https://help.ubuntu.com/community/FindPage">
<link rel="Index" href="https://help.ubuntu.com/community/TitleIndex">
<link rel="Glossary" href="https://help.ubuntu.com/community/WordIndex">
<link rel="Help" href="https://help.ubuntu.com/community/HelpOnFormatting">
</head>

<body lang="en" dir="ltr">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="http://www.ubuntu.com/partners">Partners</a> </li>
        	    <li><a href="http://www.ubuntu.com/support">Support</a></li>
        	    <li><a href="http://www.ubuntu.com/community">Community</a></li>
        	    <li><a href="http://www.ubuntu.com/">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
                    <li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a class="nbinfo" href="https://help.ubuntu.com/community/SettingUpNFSHowTo?action=info" rel="nofollow">Page History</a></li><li><a href="https://help.ubuntu.com/community/SettingUpNFSHowTo?action=login&login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 &lt;form action="http://www.google.com/cse" id="cse-search-box"&gt;
   &lt;div&gt;
     &lt;input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" /&gt;
     &lt;input type="hidden" name="ie" value="UTF-8" /&gt;
     &lt;input type="text" name="q" size="21" /&gt;
     &lt;input type="submit" name="sa" value="Search" /&gt;
   &lt;/div&gt;
 &lt;/form&gt;
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script><form action="https://help.ubuntu.com/search.html" id="cse-search-box">  <div>    <input type="hidden" name="cof" value="FORID:9">    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">    <input type="hidden" name="ie" value="UTF-8">    <input type="text" name="q" size="21">    <input type="submit" name="sa" value="Search">  </div></form>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><a class="backlink" href="https://help.ubuntu.com/community/SettingUpNFSHowTo?action=fullsearch&value=linkto%3A%22SettingUpNFSHowTo%22&context=180" rel="nofollow" title="Click to do a full-text search for this title">SettingUpNFSHowTo</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear">
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><div><table style="float:right;  font-size: 0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em;"><tbody><tr>  <td style="padding:0.5em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#TL.3BDR">TL;DR</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Introduction">Introduction</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NFS_quick_start">NFS quick start</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NFS_server">NFS server</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Portmap_Lockdown">Portmap Lockdown</a></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NFSv4_client">NFSv4 client</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Portmap_Lockdown-1">Portmap Lockdown</a></li></ol></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NFS_Server">NFS Server</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Pre-Installation_Setup">Pre-Installation Setup</a><ol><li><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#User_Permissions">User Permissions</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Group_Permissions">Group Permissions</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Host_Names">Host Names</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NIS">NIS</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Portmap_Lockdown-2">Portmap Lockdown</a></li></ol></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Installation_and_Configuration">Installation and Configuration</a><ol><li><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Install_NFS_Server">Install NFS Server</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Shares">Shares</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Restart_Services">Restart Services</a></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Security_Note">Security Note</a></li></ol></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#NFS_Client">NFS Client</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Installation">Installation</a><ol><li><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Portmap_Lockdown-3">Portmap Lockdown</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Host_Names-1">Host Names</a></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Mounts">Mounts</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Check_to_see_if_everything_works">Check to see if everything works</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Mount_at_startup">Mount at startup</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Automounter">Automounter</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Static_Mounts">Static Mounts</a></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Notes">Notes</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Minimalistic_NFS_Set_Up">Minimalistic NFS Set Up</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Using_Groups_with_NFS_Shares">Using Groups with NFS Shares</a></li></ol></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#IPSec_Notes">IPSec Notes</a></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Troubleshooting">Troubleshooting</a><ol><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Mounting_NFS_shares_in_encrypted_home_won.27t_work_on_boot">Mounting NFS shares in encrypted home won't work on boot</a></li></ol></li><li>
<a href="https://help.ubuntu.com/community/SettingUpNFSHowTo#Other_resources">Other resources</a></li></ol></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
</p><h1 id="TL.3BDR">TL;DR</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line862">A much shorter guide is available at <a class="https" href="https://help.ubuntu.com/14.04/serverguide/network-file-system.html">https://help.ubuntu.com/14.04/serverguide/network-file-system.html</a> If you need more info, read below. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867">
</p><h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">NFS (Network File System) allows you to 'share' a directory located on one networked computer with other computers/devices on that network. The computer where directory located is called the server and computers or devices connecting to that server are called clients. Clients usually 'mount' the shared directory to make it a part of their own directory structure. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span></p><p class="line874">NFS is perfect for creating NAS (Networked Attached Storage) in Linux/Unix environment. It is a native Linux/Unix protocol as opposed to Samba which uses the SMB protocol developed by Microsoft. The Apple OS has good support for NFS. Windows 7 has some support for NFS. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span></p><p class="line862">NFS is perhaps best for more 'permanent' network mounted directories such as <tt class="backtick">/home</tt> directories or regularly accessed shared resources. If you want a network share that guest users can easily connect to, Samba is more suited. This is because tools exist more readily across old and proprietary operating systems to temporarily mount and detach from Samba shares. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line874">Ubuntu Before deploying NFS you should be familiar with: <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><ul><li>Linux file and directory permissions <span class="anchor" id="line-18"></span></li><li>Mounting and detaching (unmounting) filesystems <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span></li></ul><p class="line862">This <a href="https://help.ubuntu.com/community/HowTo">HowTo</a> makes Ubuntu server NFSv4 ready. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></p><p class="line867">
</p><h1 id="NFS_quick_start">NFS quick start</h1>
<span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line874">Providing you understand what you are doing, use this brief walk-through to set up an NFSv4 server on Ubuntu (with no authentication security). Then mount the share on an Ubuntu client. It has been tested on Ubuntu 14.04.  <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span></p><p class="line867">
</p><h2 id="NFS_server">NFS server</h2>
<span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line874">To check the NSF server is not installed, you can do... <span class="anchor" id="line-29"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><pre><span class="anchor" id="line-1"></span>$ dpkg -l | grep nfs-kernel-server</pre><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></li></ul><p class="line874">Install the required packages... <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><pre><span class="anchor" id="line-1-1"></span># apt-get install nfs-kernel-server</pre><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></li></ul><p class="line874">For easier maintenance we will isolate all NFS exports in single <span class="anchor" id="line-40"></span>directory, where the real directories will be mounted with the <span class="anchor" id="line-41"></span><tt>--bind</tt> option. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p><ul><li style="list-style-type:none"><p class="line862">Let's say we want to export our users' home directories in <tt>/home/users</tt>. First we create the export filesystem: <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></p><pre><span class="anchor" id="line-1-2"></span># mkdir -p /export/users </pre><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span>It's important that /export and /export/users have 777 permissions as we will be accessing the NFS share from the client without LDAP/NIS authentication.  This will not apply if using authentication (see below). <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span>Now mount the real users directory with: <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><pre><span class="anchor" id="line-1-3"></span># mount --bind /home/users /export/users</pre><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span>To save us from retyping this after every reboot we add the following <span class="anchor" id="line-56"></span><p class="line862">line to <tt>/etc/fstab</tt> <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span></p><pre><span class="anchor" id="line-1-4"></span>/home/users    /export/users   none    bind  0  0</pre><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></li></ul><p class="line862">There are three configuration files that relate to an NFS server: <tt>/etc/default/nfs-kernel-server</tt>, <tt>/etc/default/nfs-common</tt> and <tt>/etc/exports</tt>. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></p><ul><li style="list-style-type:none"><p class="line862">The only important option in <tt>/etc/default/nfs-kernel-server</tt> for now is NEED_SVCGSSD. It is set to "no" by default, which is fine, because we are not activating NFSv4 security this time. <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span></p></li></ul><p class="line862">In order for the ID names to be automatically mapped, both the client and server require the <tt>/etc/idmapd.conf</tt> file to have the same contents with the correct domain names.   Furthermore, this file should have the following lines in the <tt>Mapping</tt> section: <span class="anchor" id="line-65"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><pre><span class="anchor" id="line-1-5"></span>[Mapping]
<span class="anchor" id="line-2"></span>
<span class="anchor" id="line-3"></span>Nobody-User = nobody
<span class="anchor" id="line-4"></span>Nobody-Group = nogroup</pre><span class="anchor" id="line-71"></span><p class="line862">However, the client may have different requirements for the <tt>Nobody-User</tt> and <tt>Nobody-Group</tt>.  For example on <a class="nonexistent" href="https://help.ubuntu.com/community/RedHat">RedHat</a>  variants, it's <tt>nfsnobody</tt> for both.  <tt>cat&nbsp;/etc/passwd</tt> and <tt>cat&nbsp;/etc/group</tt> should show the "nobody" accounts.  <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span></p></li></ul><p class="line862">This way, server and client do not need the users to share same UID/GUID. <br>
<br>
 <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></p><p class="line874">For those who use LDAP-based authentication, add the following lines to your client's idmapd.conf: <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span></p><p class="line867"><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><pre><span class="anchor" id="line-1-6"></span>[Translation]
<span class="anchor" id="line-2-1"></span>
<span class="anchor" id="line-3-1"></span>Method = nsswitch</pre><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line874">This will cause idmapd to know to look at nsswitch.conf to determine where it should look for credential information (and if you have LDAP authentication already working, nsswitch shouldn't require further explanation). <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span></p><p class="line862">To export our directories to a local network <tt>192.168.1.0/24</tt> we add the following two lines to <tt>/etc/exports</tt> <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></p><pre><span class="anchor" id="line-1-7"></span>/export       192.168.1.0/24(rw,fsid=0,insecure,no_subtree_check,async)
<span class="anchor" id="line-2-2"></span>/export/users 192.168.1.0/24(rw,nohide,insecure,no_subtree_check,async)</pre><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867">
</p><h3 id="Portmap_Lockdown">Portmap Lockdown</h3>
<span class="anchor" id="line-92"></span><p class="line867"><small>optional </small> <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span></p><p class="line874">Add the following line to /etc/hosts.deny: <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span></p><pre><span class="anchor" id="line-1-8"></span>rpcbind mountd nfsd statd lockd rquotad : ALL</pre><span class="anchor" id="line-98"></span><p class="line874">By blocking all clients first, only clients in /etc/hosts.allow below will be allowed to access the server. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span></p><p class="line874">Now add the following line to /etc/hosts.allow: <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span></p><pre><span class="anchor" id="line-1-9"></span>rpcbind mountd nfsd statd lockd rquotad : list of IP addresses</pre><span class="anchor" id="line-104"></span><p class="line874">Where the "list of IP addresses" string is, you need to make a list <span class="anchor" id="line-105"></span>of IP addresses that consists of the server and all clients. These have <span class="anchor" id="line-106"></span>to be IP addresses because of a limitation in portmap (it doesn't like <span class="anchor" id="line-107"></span>hostnames). Note that if you have NIS set up, just add these to the <span class="anchor" id="line-108"></span>same line. <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></p><p class="line867"><strong>Note:</strong> Ensure that the list of authorised IP addresses includes the localhost address (<strong>127.0.0.1</strong>) as the startup scripts in recent versions of Ubuntu use the <strong>rpcinfo</strong> command to discover NFSv3 support, and this will be disabled if localhost is unable to connect. <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span></p><p class="line874">Now restart the service <span class="anchor" id="line-113"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-114"></span><pre><span class="anchor" id="line-1-10"></span># service nfs-kernel-server restart</pre><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span></li></ul><p class="line867">
</p><h2 id="NFSv4_client">NFSv4 client</h2>
<span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><p class="line874">Install the required packages... <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-121"></span><pre><span class="anchor" id="line-1-11"></span># apt-get install nfs-common </pre><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span></li></ul><p class="line874">On the client we can mount the complete export tree with one command: <span class="anchor" id="line-124"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-125"></span><pre><span class="anchor" id="line-1-12"></span># mount -t nfs -o proto=tcp,port=2049 nfs-server:/ /mnt</pre><span class="anchor" id="line-126"></span><p class="line862">Note that <tt>nfs-server:/export</tt> is not necessary in NFSv4, as it is in NFSv3. The root export <tt>:/</tt> defaults to export with <tt>fsid=0</tt>. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span></p></li></ul><p class="line862">We can also mount an exported <em>subtree</em> with: <span class="anchor" id="line-129"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-130"></span><pre><span class="anchor" id="line-1-13"></span># mount -t nfs -o proto=tcp,port=2049 nfs-server:/users /home/users</pre><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span></li></ul><p class="line862">To save us from retyping this after every reboot we add the following line to <tt>/etc/fstab</tt>: <span class="anchor" id="line-133"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-134"></span><pre><span class="anchor" id="line-1-14"></span>nfs-server:/   /mnt   nfs    auto  0  0</pre><span class="anchor" id="line-135"></span><p class="line862">If after mounting, the entry in <tt>/proc/mounts</tt> appears as <tt>nfs-server://</tt> (with two slashes), then you might need to specify two slashes in <tt>/etc/fstab</tt>, or else <tt>umount</tt> might complain that it cannot find the mount. <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span></p><p class="line862">The <tt>auto</tt> option mounts on startup. However this will not work if your client uses a wifi connection managed at the user level (after login), because the network will not be available at boot time.  In Ubuntu 12.04 LTS and later, wifi connections are managed at the system level by default, so auto-mounting of NFS shares at boot time should work fine. <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span></p></li></ul><p class="line874">Ubuntu Server doesn't come with any init.d/netfs or other scripts to do this for you. <span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span></p><p class="line867">
</p><h3 id="Portmap_Lockdown-1">Portmap Lockdown</h3>
<span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line867"><small>optional </small> <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span></p><p class="line874">Add the following line to /etc/hosts.deny: <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span></p><pre><span class="anchor" id="line-1-15"></span>rpcbind : ALL</pre><span class="anchor" id="line-149"></span><p class="line874">By blocking all clients first, only clients in /etc/hosts.allow below will be allowed to access the server. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span></p><p class="line874">Now add the following line to /etc/hosts.allow: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span></p><pre><span class="anchor" id="line-1-16"></span>rpcbind : NFS server IP address</pre><span class="anchor" id="line-155"></span><p class="line862">Where "NFS server IP address" is the IP address of the server. <strong>This must be numeric!</strong> It's the way portmap works. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span></p><p class="line867">
</p><h1 id="NFS_Server">NFS Server</h1>
<span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><p class="line867">
</p><h2 id="Pre-Installation_Setup">Pre-Installation Setup</h2>
<span class="anchor" id="line-161"></span><p class="line867"><strong>None of the following pre-installation steps are strictly necessary.</strong> <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span></p><p class="line867">
</p><h4 id="User_Permissions">User Permissions</h4>
<span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line874">NFS user permissions are based on user ID (UID). UIDs of any users on the client must match those on the server in order for the users to have access. The typical ways of doing this are: <span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span></p><ul><li>Manual password file synchronization <span class="anchor" id="line-168"></span></li><li><p class="line862">Use of <a href="https://help.ubuntu.com/community/LDAPClientAuthentication">LDAP</a> <span class="anchor" id="line-169"></span></p></li><li><p class="line862">Use of <a href="https://help.ubuntu.com/community/SettingUpNISHowTo">NIS</a> <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span></p></li></ul><p class="line874">It's also important to note that you have to be careful on <span class="anchor" id="line-172"></span>systems where the main user has root access - that user can change <span class="anchor" id="line-173"></span>UID's on the system to allow themselves access to anyone's files. This <span class="anchor" id="line-174"></span>page assumes that the administrative team is the only group with root <span class="anchor" id="line-175"></span>access and that they are all trusted. Anything else represents a more <span class="anchor" id="line-176"></span>advanced configuration, and will not be addressed here. <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></p><p class="line867">
</p><h4 id="Group_Permissions">Group Permissions</h4>
<span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line874">With NFS, a user's access to files is determined by his/her membership of groups on the client, not on the server.  However, there is an important limitation: a maximum of 16 groups are passed from the client to the server, and, if a user is member of more than 16 groups on the client, some files or directories might be unexpectedly inaccessible. <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></p><p class="line867">
</p><h4 id="Host_Names">Host Names</h4>
<span class="anchor" id="line-183"></span><p class="line867"><small>optional if using DNS </small> <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span></p><p class="line862">Add any client name and IP addresses to /etc/hosts. The <em>real</em> (not 127.0.0.1) IP address of the server should already be here. This ensures that NFS will still work even if <span class="anchor" id="line-186"></span>DNS goes down. You could rely on DNS if you wanted, it's up to you. <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span></p><p class="line867">
</p><h4 id="NIS">NIS</h4>
<span class="anchor" id="line-189"></span><p class="line867"><small>optional - perform steps only if using NIS </small> <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></p><p class="line867"><strong>Note:</strong> This <strong>only</strong> works if using NIS. Otherwise, you can't use netgroups, and should specify individual IP's or hostnames in <tt>/etc/exports</tt>. Read the <strong>BUGS</strong> section in <tt>man&nbsp;netgroup</tt>. <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span></p><p class="line874">Edit /etc/netgroup and add a line to classify your clients. (This <span class="anchor" id="line-194"></span>step is not necessary, but is for convenience). <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span></p><pre><span class="anchor" id="line-1-17"></span>myclients (client1,,) (client2,,)</pre><span class="anchor" id="line-198"></span><p class="line862">Obviously, more clients can be added. <tt>myclients</tt> can be anything <span class="anchor" id="line-199"></span>you like; this is a <em>netgroup name</em>. <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span></p><p class="line874">Run this command to rebuild the YP database: <span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span></p><pre><span class="anchor" id="line-1-18"></span>sudo make -C /var/yp</pre><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><p class="line867">
</p><h4 id="Portmap_Lockdown-2">Portmap Lockdown</h4>
<span class="anchor" id="line-207"></span><p class="line867"><small>optional </small> <span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span></p><p class="line874">Add the following line to /etc/hosts.deny: <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span></p><pre><span class="anchor" id="line-1-19"></span>rpcbind mountd nfsd statd lockd rquotad : ALL</pre><span class="anchor" id="line-213"></span><p class="line874">By blocking all clients first, only clients in /etc/hosts.allow below will be allowed to access the server. <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span></p><p class="line874">Now add the following line to /etc/hosts.allow: <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span></p><pre><span class="anchor" id="line-1-20"></span>rpcbind mountd nfsd statd lockd rquotad : list of IP addresses</pre><span class="anchor" id="line-219"></span><p class="line874">Where the "list of IP addresses" string is, you need to make a list <span class="anchor" id="line-220"></span>of IP addresses that consists of the server and all clients. These have <span class="anchor" id="line-221"></span>to be IP addresses because of a limitation in portmap (it doesn't like <span class="anchor" id="line-222"></span>hostnames). Note that if you have NIS set up, just add these to the <span class="anchor" id="line-223"></span>same line. <span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span></p><p class="line867">
</p><h2 id="Installation_and_Configuration">Installation and Configuration</h2>
<span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><p class="line867">
</p><h4 id="Install_NFS_Server">Install NFS Server</h4>
<span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line867"><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span></p><pre><span class="anchor" id="line-1-21"></span>sudo apt-get install rpcbind nfs-kernel-server</pre><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line867">
</p><h4 id="Shares">Shares</h4>
<span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line874">Edit /etc/exports and add the shares: <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span></p><pre><span class="anchor" id="line-1-22"></span>/home @myclients(rw,sync,no_subtree_check)
<span class="anchor" id="line-2-3"></span>/usr/local @myclients(rw,sync,no_subtree_check)</pre><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line874">The above shares /home and /usr/local to all clients in the <span class="anchor" id="line-242"></span>myclients netgroup. <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span></p><p class="line867"><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span></p><pre><span class="anchor" id="line-1-23"></span>/home 192.168.0.10(rw,sync,no_subtree_check) 192.168.0.11(rw,sync,no_subtree_check)
<span class="anchor" id="line-2-4"></span>/usr/local 192.168.0.10(rw,sync,no_subtree_check) 192.168.0.11(rw,sync,no_subtree_check)</pre><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><p class="line874">The above shares /home and /usr/local to two clients with fixed ip addresses. <span class="anchor" id="line-250"></span>Best used only with machines that have static ip addresses. <span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span></p><p class="line867"><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span></p><pre><span class="anchor" id="line-1-24"></span>/home 192.168.0.0/255.255.255.0(rw,sync,no_subtree_check)
<span class="anchor" id="line-2-5"></span>/usr/local 192.168.0.0/255.255.255.0(rw,sync,no_subtree_check)</pre><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><p class="line874">The above shares /home and /usr/local to all clients in the <span class="anchor" id="line-258"></span>private network falling within the designated ip address range. <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span></p><p class="line867"><tt>rw</tt> makes the share read/write, and <tt>sync</tt> requires <span class="anchor" id="line-261"></span>the server to only reply to requests once any changes have been flushed <span class="anchor" id="line-262"></span>to disk. This is the safest option (<tt>async</tt> is faster, but <span class="anchor" id="line-263"></span>dangerous. It is strongly recommended that you read <tt>man&nbsp;exports</tt>. <span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span></p><p class="line874">After setting up /etc/exports, export the shares: <span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span></p><pre><span class="anchor" id="line-1-25"></span>sudo exportfs -ra</pre><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line862">You'll want to do this command whenever <tt>/etc/exports</tt> is modified. <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span></p><p class="line867">
</p><h4 id="Restart_Services">Restart Services</h4>
<span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><p class="line874">By default, portmap only binds to the loopback interface. To enable access to portmap from remote machines, you need to change /etc/default/portmap to get rid of either "-l" or "-i 127.0.0.1". <span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span></p><p class="line874">If /etc/default/portmap was changed, portmap will need to be restarted:  <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span></p><pre><span class="anchor" id="line-1-26"></span>sudo service portmap restart</pre><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><p class="line874">The NFS kernel server will also require a restart:  <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span></p><pre><span class="anchor" id="line-1-27"></span>sudo service nfs-kernel-server restart</pre><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867">
</p><h3 id="Security_Note">Security Note</h3>
<span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><p class="line874">Aside from the UID issues discussed above, it should be noted that an <span class="anchor" id="line-289"></span>attacker could potentially masquerade as a machine that is allowed to <span class="anchor" id="line-290"></span>map the share, which allows them to create arbitrary UIDs to access <span class="anchor" id="line-291"></span>your files. One potential solution to this is <a href="https://help.ubuntu.com/community/IPSecHowTo">IPSec</a>, see also the NFS and IPSec section below. You can set up all your domain members to talk only to each other over IPSec, which will effectively authenticate that your client is who it says it is. <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span></p><p class="line874">IPSec works by encrypting traffic to the server with the server's key, <span class="anchor" id="line-294"></span>and the server sends back all replies encrypted with the client's key. <span class="anchor" id="line-295"></span>The traffic is decrypted with the respective keys. If the client doesn't have the keys that the client is supposed to have, it can't send or receive data. <span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span></p><p class="line874">An alternative to IPSec is physically separate networks. This requires a separate network switch and separate ethernet cards, and physical security of that network. <span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span></p><p class="line867">
</p><h1 id="NFS_Client">NFS Client</h1>
<span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line867">
</p><h2 id="Installation">Installation</h2>
<span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line867"><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span></p><pre><span class="anchor" id="line-1-28"></span>sudo apt-get install rpcbind nfs-common</pre><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><p class="line867">
</p><h4 id="Portmap_Lockdown-3">Portmap Lockdown</h4>
<span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><p class="line867"><small>optional </small> <span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span></p><p class="line874">Add the following line to /etc/hosts.deny: <span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span></p><pre><span class="anchor" id="line-1-29"></span>rpcbind : ALL</pre><span class="anchor" id="line-315"></span><p class="line874">By blocking all clients first, only clients in /etc/hosts.allow below will be allowed to access the server. <span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span></p><p class="line874">Now add the following line to /etc/hosts.allow: <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span></p><pre><span class="anchor" id="line-1-30"></span>rpcbind : NFS server IP address</pre><span class="anchor" id="line-321"></span><p class="line862">Where "NFS server IP address" is the IP address of the server. <strong>This must be numeric!</strong> It's the way portmap works. <span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span></p><p class="line867">
</p><h4 id="Host_Names-1">Host Names</h4>
<span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><p class="line867"><small>optional if using DNS </small> <span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span></p><p class="line874">Add the server name to /etc/hosts.  This ensures the NFS mounts will still work even if <span class="anchor" id="line-328"></span>DNS goes down. You could rely on DNS if you wanted, it's up to you. <span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span></p><p class="line867">
</p><h3 id="Mounts">Mounts</h3>
<span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><p class="line867">
</p><h4 id="Check_to_see_if_everything_works">Check to see if everything works</h4>
<span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><p class="line874">You should try and mount it now. The basic template you will use is: <span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span></p><pre><span class="anchor" id="line-1-31"></span>sudo mount ServerIP:/folder/already/setup/to/be/shared /home/username/folder/in/your/local/computer</pre><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><p class="line874">so for example: <span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span></p><p class="line867"><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span></p><pre><span class="anchor" id="line-1-32"></span>sudo mount 192.168.1.42:/home/music /home/poningru/music</pre><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><p class="line867">
</p><h4 id="Mount_at_startup">Mount at startup</h4>
<span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><p class="line874">NFS mounts can either be automatically mounted when accessed using autofs or can be setup with static mounts using entries in /etc/fstab. Both are explained below. <span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span></p><p class="line867">
</p><h4 id="Automounter">Automounter</h4>
<span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><p class="line874">Install autofs: <span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span></p><pre><span class="anchor" id="line-1-33"></span>sudo apt-get install autofs</pre><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><p class="line874">The following configuration example sets up home directories to automount off an NFS server upon logging in.  Other directories can be setup to automount upon access as well. <span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span></p><p class="line874">Add the following line to the end of /etc/auto.master: <span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span></p><pre><span class="anchor" id="line-1-34"></span>  /home         /etc/auto.home</pre><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><p class="line874">Now create /etc/auto.home and insert the following: <span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span></p><pre><span class="anchor" id="line-1-35"></span>  *             solarisbox1.company.com.au,solarisbox2.company.com.au:/export/home/&amp;</pre><span class="anchor" id="line-368"></span><p class="line874">The above line automatically mounts any directory accessed at /home/[username] on the client machine from either solarisbox1.company.com.au:/export/home/[username] or solarisbox2.company.com.au:/export/home/[username]. <span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span></p><p class="line874">Restart autofs to enable the configuration: <span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span></p><pre><span class="anchor" id="line-1-36"></span>sudo service autofs start</pre><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><p class="line867">
</p><h4 id="Static_Mounts">Static Mounts</h4>
<span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><p class="line874">Prior to setting up the mounts, make sure the directories that will act as mountpoints are already created. <span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span></p><p class="line874">In /etc/fstab, add lines for shares such as: <span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span></p><pre><span class="anchor" id="line-1-37"></span>servername:dir /mntpoint nfs rw,hard,intr 0 0</pre><span class="anchor" id="line-383"></span><p class="line862">The <tt>rw</tt> mounts it read/write. Obviously, if the server is sharing <span class="anchor" id="line-384"></span>it read only, <span class="anchor" id="line-385"></span>the client won't be able to mount it as anything more than that. The <span class="anchor" id="line-386"></span><tt>hard</tt> mounts the share such that if the server becomes <span class="anchor" id="line-387"></span>unavailable, the program will wait until it is available. The <span class="anchor" id="line-388"></span>alternative is <tt>soft</tt>. <tt>intr</tt> allows you to interrupt/kill the <span class="anchor" id="line-389"></span>process. Otherwise, it will ignore you. Documentation for these can be <span class="anchor" id="line-390"></span>found in the <tt>Mount&nbsp;options&nbsp;for&nbsp;nfs</tt> section of <tt>man&nbsp;mount</tt>. <span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span></p><p class="line862">The filesystems can now be mounted with <tt>mount&nbsp;/mountpoint</tt>, or <tt>mount&nbsp;-a</tt> to mount everything that should be mounted at boot. <span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span></p><p class="line867">
</p><h3 id="Notes">Notes</h3>
<span class="anchor" id="line-395"></span><p class="line867">
</p><h4 id="Minimalistic_NFS_Set_Up">Minimalistic NFS Set Up</h4>
<span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><p class="line874">The steps above are very comprehensive. The minimum number of steps required to set up NFS are listed here: <span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span></p><p class="line867"><a class="http" href="http://www.ubuntuforums.org/showthread.php?t=249889">http://www.ubuntuforums.org/showthread.php?t=249889</a> <span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span></p><p class="line867">
</p><h4 id="Using_Groups_with_NFS_Shares">Using Groups with NFS Shares</h4>
<span class="anchor" id="line-402"></span><p class="line862">When using groups on NFS shares (NFSv2 or NFSv3), keep in mind that this might not work if a user is a member of more than 16 groups. This is due to limitations in the NFS protocol. You can find more information on Launchpad (<a class="https" href="https://bugs.launchpad.net/ubuntu/+source/linux-source-2.6.20/+bug/110132">"Permission denied when user belongs to group that owns group writable or setgid directories mounted via nfs"</a>) and in this article: <a class="http" href="http://nfsworld.blogspot.com/2005/03/whats-deal-on-16-group-id-limitation.html">"What's the deal on the 16 group id limitation in NFS?"</a> <span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span></p><p class="line867">
</p><h2 id="IPSec_Notes">IPSec Notes</h2>
<span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><p class="line874">If you're using IPSec, the default shutdown order in Breezy/Dapper causes the client to hang as it's being shut down because IPSec goes down before NFS does. To fix it, do: <span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span></p><p class="line867"><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span></p><pre><span class="anchor" id="line-1-38"></span>sudo update-rc.d -f setkey remove
<span class="anchor" id="line-2-6"></span>sudo update-rc.d setkey start 37 0 6 S .</pre><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><p class="line874">A bug has been filed here: <span class="anchor" id="line-414"></span><a class="https" href="https://launchpad.net/distros/ubuntu/+source/ipsec-tools/+bug/37536">https://launchpad.net/distros/ubuntu/+source/ipsec-tools/+bug/37536</a> <span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span></p><p class="line867">
</p><h2 id="Troubleshooting">Troubleshooting</h2>
<span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><p class="line867">
</p><h3 id="Mounting_NFS_shares_in_encrypted_home_won.27t_work_on_boot">Mounting NFS shares in encrypted home won't work on boot</h3>
<span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><p class="line862">Mounting an NFS share inside an encrypted home directory will only work after you are successfully logged in and your home is decrypted. This means that using <tt>/etc/fstab</tt> to mount NFS shares on boot will not work - because your home has not been decrypted at the time of mounting. There is a simple way around this using Symbolic links: <span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span></p><ul><li>Create an alternative directory to mount the NFS shares in: <span class="anchor" id="line-423"></span></li></ul><p class="line867"><span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span></p><pre><span class="anchor" id="line-1-39"></span>$ sudo mkdir /nfs
<span class="anchor" id="line-2-7"></span>$ sudo mkdir /nfs/music</pre><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><ul><li><p class="line862">Edit <tt>/etc/fstab</tt> to mount the NFS share into that directory instead: <span class="anchor" id="line-429"></span></p></li></ul><p class="line867"><tt>nfsServer:music&nbsp;&nbsp;&nbsp;&nbsp;/nfs/music&nbsp;&nbsp;&nbsp;&nbsp;nfs&nbsp;&nbsp;&nbsp;&nbsp;auto&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;0</tt> <span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span></p><ul><li>Create a symbolic link inside your home, pointing to the actual mount location (in our case delete the 'Music' directory already existing there first): <span class="anchor" id="line-432"></span></li></ul><p class="line867"><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span></p><pre><span class="anchor" id="line-1-40"></span>$ rmdir /home/user/Music
<span class="anchor" id="line-2-8"></span>$ ln -s /nfs/music/ /home/user/Music</pre><span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><p class="line867">
</p><h2 id="Other_resources">Other resources</h2>
<span class="anchor" id="line-438"></span><ul><li><p class="line891"><a class="http" href="http://www.nfsv4.org/">http://www.nfsv4.org/</a> <span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span></p></li></ul><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-441"></span><span class="anchor" id="bottom"></span></p></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" lang="en" dir="ltr">SettingUpNFSHowTo  (last edited 2014-09-04 10:26:56 by <span title="techtonik @ mm-127-247-57-86.leased.line.mgts.by[86.57.247.127]"><a class="interwiki" href="https://launchpad.net/~techtonik" title="techtonik @ mm-127-247-57-86.leased.line.mgts.by[86.57.247.127]">techtonik</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details<br><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div>


</body></html>