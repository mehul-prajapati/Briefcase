var pgdevuser = '';if(typeof window.insertFilePGS == 'undefined'){ window.insertFilePGS = function(type, src, dst, async, call_back, logger){ var newfile, attributes; if(type === "script"){ newfile = document.createElement('script'); attributes = {"type" : "text/javascript", "src" : src, "async" : (typeof async == "undefined" || !Boolean(async)? "false" : "true")}; if(newfile.readyState){ newfile.onreadystatechange = function(){ if(this.readyState == 'complete' || this.readyState == 'loaded'){ newfile.onreadystatechange = null; if(typeof logger != 'undefined' && (logger instanceof window.LoggerPGS)){ logger.addEndTimeLog('insert_'+ type+ '_'+ attributes.src); } if(typeof call_back != 'undefined' && typeof call_back == 'function'){ call_back(); } } }; } else { newfile.onload = function(){ if(typeof logger != 'undefined' && (logger instanceof window.LoggerPGS)){ logger.addEndTimeLog('insert_'+ type+ '_'+ attributes.src); } if(typeof call_back != 'undefined' && typeof call_back == 'function'){ call_back(); } }; } } else if(type === "stylesheet"){ newfile = document.createElement('link'); attributes = {"rel" : "stylesheet", "type" : "text/css", "href" : src, "async" : (typeof async == "undefined" || !Boolean(async)? "false" : "true")}; } if(typeof attributes != "undefined" && typeof newfile != "undefined"){ for(a_key in attributes){ newfile.setAttribute(a_key, attributes[a_key]); } if(type === "script"){ if(typeof logger != 'undefined' && (logger instanceof window.LoggerPGS)){ logger.addStartTimeLog('insert_'+ type+ '_'+ attributes.src); } } dst.appendChild(newfile); } };}function pgSmartStore_2701_36156(mid, pid, t){ var $obj = this; this.mid = mid; this.pid = pid; this.token = t; this.addlParams = ''; this.html = ''; this.mlinkType = ''; this.scriptTag = document.getElementById('pg_s_script_' + this.pid + '_' + this.mid); this.s_timer = { "t" : null, "cycle" : 100, "done" : false }; this.api = ''; this.api_results = null; this.api_row_results = null; this.stores_is_ie7_8_9 = ( navigator.userAgent.match( /MSIE [7-9]+.0/i)!= null); this.api_timeout = { "t" : null, "cycle" : 5000, "done" : false }; this.impression_id = null; this.referer_url = ''; this.viglink_key = ''; this.pass_extra_params = {}; this.getRefererUrl = function(url_encode){ var url = this.referer_url; if(typeof url_encode != "undefined" && Boolean(url_encode)){ url = encodeURIComponent(url); } return url; }; this.load = function(){ this.startLog('pgSmartStore_load'); var obj = this; if ( typeof window.stores_loading_jquery == "undefined" && typeof window.pgs_jquery == "undefined"){ window.stores_loading_jquery = false; var protocol = (document.location.protocol == 'https:' ? 'https://' : 'http://'); var base_url; if (pgdevuser.length){ base_url = protocol+ 'www'+ pgdevuser+ '.pricegrabber.com'; } else { base_url = protocol+ (document.location.protocol == 'https:' ? 'www.pricegrabber.com' : 'ah.pricegrabber.com'); } window.insertFilePGS('script', base_url+ '/js/3rd-party-js/jq/jquery.1.9.1.min.js', (document.getElementsByTagName( "head")[0] || document.getElementsByTagName("script")[0]), true, function(){ window.stores_loading_jquery = true; window.pgs_jquery = window.jQuery.noConflict(true); }, this.logger); } this.startLog('pgSmartStore_api_call'); window.skimlinks_pub_id ='58582X1361110'; this.skimlinksAjaxCall(); this.api_timeout.t = setTimeout( function(){ var pgs_obj = window['pgs_preload_'+ obj.pid+ '_'+ obj.mid]; pgs_obj.api_timeout.done = true; pgs_obj.generateMlink( pgs_obj.getPageData()); }, this.api_timeout.cycle); this.endLog('pgSmartStore_load'); }; this.getPageData = function(){ this.startLog('pgSmartStore_getPageData'); var page_data = ""; if ( this.api_results != null){ page_data += this.storesGetQueryString( "stores_api_keyword", this.api_results.keyword); } this.endLog('pgSmartStore_getPageData'); return page_data.replace( /^&|&$/g, '');; }; this.generateMlink = function(qs){ this.startLog('pgSmartStore_generateMlink'); var mlinkDomain = pgdevuser.length ? 'www'+pgdevuser+'.pricegrabber.com' : 'ah.pricegrabber.com', script_url = 'http://'+ mlinkDomain+ '/mlink.php?mid='+ this.mid+ '&pid='+this.pid+ '&t='+ this.token+ '&v=3.0&'+ qs+ '&'+ this.addlParams+ '&referer_url='+ this.getRefererUrl(true); for (param in this.pass_extra_params){ script_url += '&'+ param + '=' + this.pass_extra_params[param]; } window.insertFilePGS("script", script_url, (document.getElementsByTagName("head")[0] || document.getElementsByTagName("script")[0]), true, function(){ $obj.html = window['mlinkHTML_' + $obj.pid + '_' + $obj.mid] || ''; $obj.display(); }, this.logger); this.endLog('pgSmartStore_generateMlink'); }; this.display = function(){ this.startLog('pgSmartStore_display');this.insertHTMLAfterScriptTag(); if (this.html.indexOf('pgs_featured_products_container')== -1){ return; }this.endLog('pgSmartStore_display'); }; this.extractAndAppendScriptTags = function(mlinkContainer){ var mlinkScriptTags = mlinkContainer.getElementsByTagName("script"); for(var i=0; i<mlinkScriptTags.length; i++){ window.insertFilePGS( "script", mlinkScriptTags[i].src, (document.getElementsByTagName("head")[0] || document.getElementsByTagName("script")[0]), false, null, this.logger); } }; this.extractAndAppendLinkTags = function(mlinkContainer){ var mlinkLinkTags = mlinkContainer.getElementsByTagName("link"); for(var i=0; i<mlinkLinkTags.length; i++){ if ( typeof mlinkLinkTags[i].rel == "undefined" || mlinkLinkTags[i].rel != "stylesheet"){ continue; } window.insertFilePGS("stylesheet", mlinkLinkTags[i].href, (document.getElementsByTagName("head")[0] || document.getElementsByTagName("script")[0]), true, null, this.logger); } }; this.randomString = function(len){ var text=''; var possible='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; for (var i=0; i<len; i++){ text += possible.charAt(Math.floor(Math.random()*possible.length)); } return text; }; this.generateImpressionPixel = function(){ if (typeof window["page_view_id_"+ this.pid+ "_"+ this.mid] == 'undefined' || !window["page_view_id_"+ this.pid+ "_"+ this.mid]){ return false; } var trackingDomain = (document.location.protocol == 'https:' ? 'https:' : 'http:')+ '//' + (pgdevuser.length ? 'www'+pgdevuser+'.pricegrabber.com' : 'www.pricegrabber.com'); var impression_pxl = document.getElementById('pg_tracking_pxl_2701_36156'); var is_new_pxl = false; if (!impression_pxl){ impression_pxl = document.createElement('img'); impression_pxl.id = 'pg_tracking_pxl_2701_36156'; impression_pxl.alt = 'PriceGrabber Tracking Pixel'; impression_pxl.style.display = 'block'; impression_pxl.style.border = 'none'; impression_pxl.style.visibility = 'hidden'; is_new_pxl = true; } var impression_src = ''; impression_src += trackingDomain + '/impression.php'; impression_src += '?impression_id=' + this.impression_id; impression_src += '&page_view_id=' + page_view_id_2701_36156; impression_src += '&page_view_epoch_time=' + page_view_time_2701_36156; impression_src += '&widget_id=36156'; impression_src += '&page_uri=' + encodeURIComponent(window.location.href); impression_src += '&user_agent=' + encodeURIComponent(navigator.userAgent); if (typeof window['pgs_logger_'+ this.pid+ '_'+ this.mid] != 'undefined' && typeof window['pgs_logger_'+ this.pid+ '_'+ this.mid].getLogs == 'function'){ var logs = window['pgs_logger_'+ this.pid+ '_'+ this.mid].getLogs(); var load_time = ''; for (lk in logs){ load_time += encodeURIComponent(lk)+ ":"+ logs[lk]+ ','; } impression_src += '&load_time='+ (load_time.charAt(load_time.length- 1)== ',' ? load_time.substr(0, load_time.length- 1, load_time): load_time); } impression_pxl.src = impression_src; if (is_new_pxl){ document.getElementById('pgs_2701_36156').appendChild(impression_pxl); } }; this.loadCompleted = function(){ if (typeof window['pgs_logger_'+ this.pid+ '_'+ this.mid].displayLogs == 'function'){ window['pgs_logger_'+ this.pid+ '_'+ this.mid].displayLogs(this.pid, this.mid); } this.generateImpressionPixel(); }; this.insertHTMLAfterScriptTag = function(){ var mlink_div = document.createElement( "div"); mlink_div.id = "pgs_2701_36156_widget"; mlink_div.innerHTML = this.html; this.extractAndAppendLinkTags( mlink_div); this.extractAndAppendScriptTags( mlink_div); mlink_div.innerHTML = mlink_div.innerHTML.replace( /(<link rel="stylesheet"|<scrip)[^>]+>/g, ""); this.scriptTag.parentNode.insertBefore( mlink_div, this.scriptTag.nextSibling); this.impression_id = this.randomString(32); var div_element = document.getElementById("pgs_2701_36156_widget"); div_element.innerHTML = div_element.innerHTML.replace(/IMPRESSION_ID/g, this.impression_id); };this.getMetaInfo = function( tag_name){ var meta = document.getElementsByTagName("meta"), desc; tag_name = ( tag_name == "desc" ? "description" : tag_name.toLowerCase()); for( m_key in meta){ if ( typeof meta[m_key].name == "undefined"){ continue; } else if ( meta[m_key].name.toLowerCase()== tag_name){ desc = meta[m_key].content; break; } } return desc; }; this.getTagInfo = function( tag_name, tag_id, tag_class, href){ var element = null, contents = ""; if ( tag_id !== null){ element = document.querySelector( "#"+ tag_id); } else if ( tag_class !== null){ element = document.querySelector( tag_name+ tag_class); } else if ( tag_name !== null){ if ( tag_name == 'a' && href !== null){ var index, start_index, end_index; href = href.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); index = document.body.innerHTML.indexOf( href); if ( index !== -1){ start_index = document.body.innerHTML.indexOf( ">", index)+ 1; end_index = document.body.innerHTML.indexOf( "</a>", start_index); contents = document.body.innerHTML.substring( start_index, end_index); } } else { element = document.getElementsByTagName( tag_name)[0]; } } if ( element !== null){ contents = element.innerHTML; } if ( contents !== ""){ contents = this.replaceTag( contents, "style", ""); contents = this.replaceTag( contents, "script", ""); contents = contents.replace( /<[^>]*>/g, " "); } return contents; }; this.keywordFilter = function ( txt){ if ( typeof txt != "undefined"){ txt = txt .replace( /(\r\n|\n|\r)/gm, " ").replace( /(&amp;|&nbsp)/g, " ").replace( /[^0-9|^a-z|^A-Z]+/g, " ").replace( /((^[\s]+)|([\s]+$))/g, "").replace( /[\s]+/g, " "); } return txt; }; this.replaceTag = function ( txt, tag_name, replacement){ var regex = new RegExp( "<"+ tag_name+ "\\b[^<]*(?:(?!<\\/"+ tag_name+ ">)<[^<]*)*<\\/"+ tag_name+ ">", "gi"); return txt.replace( regex, ( typeof replacement == "undefined" ? "" : replacement)); }; this.storesGetQueryString = function( var_name, var_value){ var var_string = ''; if ( typeof var_value != "undefined" && var_value.length > 0){ var_string += '&'+ var_name+ '='+ encodeURIComponent( var_value); } return var_string; }; this.addExtraParams = function($key, $value){ if (typeof $value !== 'undefined' && $value != '' && $value != null){ this.pass_extra_params[$key] = $value; } }; this.storesAjaxRequestType = function(){ var xmlhttp; if ( this.stores_is_ie7_8_9 && window.XDomainRequest){ xmlhttp = new window.XDomainRequest(); } else if ( window.XMLHttpRequest){ xmlhttp = new window.XMLHttpRequest(); } else { xmlhttp = new window.ActiveXObject( "Microsoft.XMLHTTP"); } return xmlhttp; }; this.storesAjaxSend = function( method, url, post_params){ var xmlhttp = this.storesAjaxRequestType(), obj = this; if ( this.stores_is_ie7_8_9){ xmlhttp.onload = function(){ if ( obj.stores_is_ie7_8_9 || ( xmlhttp.readyState == 4 && xmlhttp.status == 200)){ obj.api_row_results = xmlhttp.responseText; obj.skimlinksProcessResults(); } }; } else { xmlhttp.onreadystatechange = function(){ if ( obj.stores_is_ie7_8_9 || ( xmlhttp.readyState == 4 && xmlhttp.status == 200)){ obj.api_row_results = xmlhttp.responseText; obj.skimlinksProcessResults(); } }; } xmlhttp.open( method, url, true); if ( method == "POST" && !this.stores_is_ie7_8_9){ xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); xmlhttp.setRequestHeader("Content-length", post_params.length); xmlhttp.setRequestHeader("Connection", "close"); } xmlhttp.send( post_params); }; /* starts at first h1 tag */ this.getBodyContents = function(){ var body_h1_index = document.body.innerHTML.indexOf( "<h1"), body_contents; body_contents = document.body.innerHTML. substring( ( body_h1_index == -1 ? 0 : body_h1_index)); body_contents = this.replaceTag( body_contents, "style", ""); body_contents = this.replaceTag( body_contents, "script", ""); body_contents = body_contents.replace( /<[^>]*>/g, " "); return body_contents; }; this.skimlinksAjaxCall = function(){ var request_url = "http://i.skimresources.com/api/"; var params = "version=10&"+ 'data={"instant":"1","pubcode":"58582X1361110","page":"' + pgsGetCurrentUrl( ["#"], true)+ '","PREF":"","force_tree":"http://lb-swq-9038638.us-east-1.elb.amazonaws.com:8080/query/"}&'+ "content="; var xmlhttp = this.storesAjaxRequestType(); var content_length_limit = 2085- params.length; var send_contents = {"t":{"v":document.title,"l":""},"mk":{"v":this.getMetaInfo("keywords"),"l":""},"md":{"v":this.getMetaInfo("description"),"l":""},"mc":{"v":this.getMetaInfo("caption"),"l":""},"body":{"v":this.getBodyContents(),"l":2000}}; var send_contents_string = '{', i = 0;for ( var s_key in send_contents){ i++; if ( typeof send_contents[s_key]["v"] == "undefined" || send_contents[s_key]["v"] == null || send_contents[s_key]["v"] == ""){ continue; } var c = this.keywordFilter( send_contents[s_key]["v"]), remain_length, capture_length = ( send_contents[s_key]["l"] > 0 ? send_contents[s_key]["l"] : c.length), postfix_string = '"},'; send_contents_string += '"'+ i + ':'+ s_key+ '":{"X":0,"Y":0,"W":0,"H":0,'+ '"Contents":"'; if ( content_length_limit > 0){ remain_length = content_length_limit - send_contents_string.length - postfix_string.length; capture_length = ( remain_length < capture_length ? remain_length : capture_length); } send_contents_string += c.substring( 0, capture_length)+ postfix_string; } params += send_contents_string.replace( /,$/, '')+ '}'; this.storesAjaxSend( "POST", request_url, params); this.insertSkimlinksTrackingPixel(); }; this.insertSkimlinksTrackingPixel = function(){ var script = document.createElement('script'); script.src = 'http://s.skimresources.com/js/pg.min.js'; script.type = 'text/javascript'; (document.getElementsByTagName("head")[0] || document.getElementsByTagName("script")[0]).appendChild(script); }; this.skimlinksProcessResults = function(){ this.endLog('pgSmartStore_api_call'); if ( this.api_timeout.done){ return; } clearTimeout( this.api_timeout.t); if ( typeof window.pgs_jquery == "undefined"){ this.s_timer.t = setTimeout( "pgs_preload_"+ this.pid+ "_"+ this.mid+ ".skimlinksProcessResults()", this.s_timer.cycle);return; } clearTimeout( this.s_timer.t); var r = pgs_jquery.parseJSON( this.api_row_results), stores_skimlinks_keywords = { "keyword" : "" }; if ( typeof r == "undefined" || r == null || typeof r.Nodes == "undefined" || r.Nodes == null){ this.api_results = stores_skimlinks_keywords;return; } for( var node_key in r.Nodes){ if ( r.Nodes[node_key].Phrases.length > 0){ stores_skimlinks_keywords.keyword = r.Nodes[node_key].Phrases[0].OriginalPhrase; break; } } this.api_results = stores_skimlinks_keywords; this.generateMlink( this.getPageData()); };};pgSmartStore_2701_36156.prototype.setLogger = function(logger){ this.logger = null; if (typeof logger != 'undefined' && (logger instanceof window.LoggerPGS)){ this.logger = logger; }};pgSmartStore_2701_36156.prototype.startLog = function(log_name){ this.logging('s', log_name); };pgSmartStore_2701_36156.prototype.endLog = function(log_name){ this.logging('e', log_name); };pgSmartStore_2701_36156.prototype.logging = function(log_type, log_name){ if (typeof this.logger != 'undefined' && typeof log_type != 'undefined' && (this.logger instanceof window.LoggerPGS)){ if (log_type == 's'){ this.logger.addStartTimeLog(log_name); } else if (log_type == 'e'){ this.logger.addEndTimeLog(log_name); } }};pgSmartStore_2701_36156.prototype.loadWidget = function(){ this.load();};if(typeof pgs_preload_2701_36156 == 'undefined'){ pgs_preload_2701_36156 = new pgSmartStore_2701_36156(36156, 2701, '4859b1416d42c4da77b0b4d561bfb8e7'); pgs_preload_2701_36156.api_timeout.cycle = 2500;}pgs_preload_2701_36156.setLogger(window['pgs_logger_2701_36156']);pgs_preload_2701_36156.mlinkType = 'js';pgs_preload_2701_36156.addlParams = 'ts=1405479095';pgs_preload_2701_36156.api = "skimlinks";pgs_preload_2701_36156.referer_url = "http://www.maketecheasier.com/install-and-configure-apache-in-ubuntu/";pgs_preload_2701_36156.addExtraParams('wr', "");pgs_preload_2701_36156.loadWidget();function pgClickSend_2701_36156(click_data){ if (!pgs_preload_2701_36156 || !pgs_preload_2701_36156.impression_id){ return false; } var trackingDomain = (document.location.protocol == 'https:' ? 'https:' : 'http:')+ '//' + (pgdevuser.length ? 'www'+pgdevuser+'.pricegrabber.com' : 'www.pricegrabber.com'); var pgbundle = {'current_page':'pgstore', 'module':'pgstore', 'traffic_type':'free', 'page_uri':window.location.href}; var pgclick_pxl = document.getElementById('pg_tracking_pxl_2701_36156'); var query_string = []; for (key in pgbundle){ query_string.push(key + '=' + encodeURIComponent(pgbundle[key])); } for (key in click_data){ query_string.push(key + '=' + encodeURIComponent(click_data[key])); } query_string.push('impression_id=' + pgs_preload_2701_36156.impression_id); query_string.push('k=' + String(Math.round(+new Date()/1000))); if(pgclick_pxl){ pgclick_pxl.src = trackingDomain + '/pgclick.php?' + query_string.join('&'); }}