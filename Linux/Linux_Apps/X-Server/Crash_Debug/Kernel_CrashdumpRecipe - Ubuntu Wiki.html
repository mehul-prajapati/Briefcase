<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="noindex,nofollow">

<title>Kernel/CrashdumpRecipe - Ubuntu Wiki</title>
<script type="text/javascript" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://wiki.ubuntu.com/Home">
<link rel="Alternate" title="Wiki Markup" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe?action=print">
<link rel="Up" href="https://wiki.ubuntu.com/Kernel">
<link rel="Search" href="https://wiki.ubuntu.com/FindPage">
<link rel="Index" href="https://wiki.ubuntu.com/TitleIndex">
<link rel="Glossary" href="https://wiki.ubuntu.com/WordIndex">
<link rel="Help" href="https://wiki.ubuntu.com/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">

<!-- BEGIN HEADER -->
<div id="wrapper" class="hfeed">
<div id="header">
    <ul id="mothership">
        <li> <a href="http://www.ubuntu.com/partners">Partners</a> </li>
        <li> <a href="http://www.ubuntu.com/support">Support</a> </li>
        <li> <a href="http://www.ubuntu.com/community">Community</a> </li>
        <li> <a href="http://www.ubuntu.com/">Ubuntu.com</a> </li>
    </ul>

    <div id="orangeHeader">
        <h1> <a href="https://wiki.ubuntu.com/" title="Ubuntu Wiki"><span>Ubuntu Wiki</span></a> </h1>
            <div id="search-box">

<form id="searchform" method="get" action="/Kernel/CrashdumpRecipe">
<div>
<input name="action" value="fullsearch" type="hidden">
<input name="context" value="180" type="hidden">
<label style="display: none;" for="searchinput">Search:</label>
<input class="disabled" id="searchinput" name="value" value="Search" size="20" onfocus="searchFocus(this)" onblur="searchBlur(this)" onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search" type="text">
<input disabled="disabled" id="titlesearch" name="titlesearch" value="Titles" alt="Search Titles" type="submit">
<input disabled="disabled" id="fullsearch" name="fullsearch" value="Text" alt="Search Full Text" type="submit">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>


            </div>
    </div>

</div>
    <div id="wikinav"> 
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li><a class="nbinfo" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/Kernel/CrashdumpRecipe">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) &amp;&amp;
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option selected="selected" value="show">More Actions:</option><option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="RenamePage" disabled="disabled" class="disabled">Rename Page</option>
<option value="CopyPage">Copy Page</option>
<option value="DeletePage" disabled="disabled" class="disabled">Delete Page</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Subscribe User</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Remove Spam</option>
<option value="show" disabled="disabled" class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="SyncPages">Sync Pages</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="username">
<li><a href="https://wiki.ubuntu.com/Home">Ubuntu Wiki</a></li>
<li><a href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe?action=login">Login</a></li>
<li><a href="https://wiki.ubuntu.com/HelpContents">Help</a></li>
</ul>

        <hr class="clearBoth">
    </div>
    
	<div id="main"> 
		<div id="container">
			<div id="content">
		<h2 class="entry-title"> 
<span><a href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe">CrashdumpRecipe</a></span>
</h2>
	<div class="hentry post">
               
<div id="message">
<p></p><div class="info"><strong>Redirected from page "<a href="https://wiki.ubuntu.com/KernelTeam/CrashdumpRecipe?action=show">KernelTeam/CrashdumpRecipe</a>"</strong><br></div><p></p><a class="clear-link" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe">Clear message</a>
</div>

<div id="page" dir="ltr" lang="en">

<!-- END HEADER --><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"></p><div dir="ltr" id="Kernel.2BAC8-MenuBar.content" lang="en"><span class="anchor" id="Kernel.2BAC8-MenuBar.top"></span>
<span class="anchor" id="Kernel.2BAC8-MenuBar.line-1"></span><span class="anchor" id="Kernel.2BAC8-MenuBar.line-2"></span><div><table style="width:100%;"><tbody><tr>  <td style="width: 40px;  border: none;  -moz-border-radius-topleft: 15px ; -moz-border-radius-bottomleft: 15px;  background-color: #F1F1DD;"><p class="line891"><img alt="IconsPage/iconCircle48.png" class="attachment" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/IconsPage.png" title="IconsPage/iconCircle48.png"></p></td>
  <td style="width: 20%;  border: none;  -moz-border-radius-topright: 15px; -moz-border-radius-bottomright: 15px;  font-size: 0.90em;  background-color: #F1F1DD;"><p class="line891"><a href="https://wiki.ubuntu.com/Kernel">Ubuntu Kernel Main</a></p></td>
  <td colspan="2" style="border:none; text-align: center"></td>
  <td style="width: 40px;  border: none;  -moz-border-radius-topleft: 15px ; -moz-border-radius-bottomleft: 15px;  background-color: #F1F1DD;"><p class="line891"><img alt="information.png" class="attachment" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/MenuBar.png" title="information.png"></p></td>
  <td style="width: 20%;  border: none;  -moz-border-radius-topright: 15px; -moz-border-radius-bottomright: 15px;  font-size: 0.90em;  background-color: #F1F1DD;"><p class="line891"><a href="https://wiki.ubuntu.com/Kernel/Debugging">Kernel Debugging</a></p></td>
  <td colspan="2" style="border:none; text-align: center"></td>
  <td style="width: 40px;  border: none;  -moz-border-radius-topleft: 15px ; -moz-border-radius-bottomleft: 15px;  background-color: #F1F1DD;"><p class="line891"><img alt="IconsPage/IconBug.png" class="attachment" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/IconsPage_002.png" title="IconsPage/IconBug.png"></p></td>
  <td style="width: 20%;  border: none;  -moz-border-radius-topright: 15px; -moz-border-radius-bottomright: 15px;  font-size: 0.90em;  background-color: #F1F1DD;"><p class="line891"><a href="https://wiki.ubuntu.com/Kernel/BugTriage">Bug Triage</a></p></td>
  <td colspan="2" style="border:none; text-align: center"></td>
  <td style="width: 40px;  border: none;  -moz-border-radius-topleft: 15px ; -moz-border-radius-bottomleft: 15px;  background-color: #F1F1DD;"><p class="line891"><img alt="testing.png" class="attachment" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/MenuBar_002.png" title="testing.png"></p></td>
  <td style="width: 20%;  border: none;  -moz-border-radius-topright: 15px; -moz-border-radius-bottomright: 15px;  font-size: 0.90em;  background-color: #F1F1DD;"><p class="line891"><a href="https://wiki.ubuntu.com/Kernel/Dev">Kernel Development</a></p></td>
  <td colspan="2" style="border:none; text-align: center"></td>
  <td style="width: 40px;  border: none;  -moz-border-radius-topleft: 15px ; -moz-border-radius-bottomleft: 15px;  background-color: #F1F1DD;"><p class="line891"><img alt="todo.png" class="attachment" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/MenuBar_003.png" title="todo.png"></p></td>
  <td style="width: 20%;  border: none;  -moz-border-radius-topright: 15px; -moz-border-radius-bottomright: 15px;  font-size: 0.90em;  background-color: #F1F1DD;"><p class="line891"><a href="https://wiki.ubuntu.com/Kernel/FAQ">Frequently Asked Questions</a></p></td>
</tr>
</tbody></table></div><span class="anchor" id="Kernel.2BAC8-MenuBar.line-3"></span><span class="anchor" id="Kernel.2BAC8-MenuBar.bottom"></span></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
</p><h1 id="Ubuntu_Kernel_Crash_Dump">Ubuntu Kernel Crash Dump</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line862">The
 Ubuntu Kernel Crash Dump is a mechanism that enable enterprise style 
post-mortem crash analysis in Linux operating systems. It uses a special
 mode of kexec which allows to automatically boot a secondary kernel 
whenever a crash (Oops/panic) occurs. This secondary kernel will then 
save the state and memory of the primary kernel to a certain location of
 the filesystem (<em>/var/crash</em> on newer releases). <span class="anchor" id="line-6"></span>This file can then be used by <strong>crash</strong> to gather detailed information about the problem. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span></p><p class="line874">For convenience, the kernel crash dump utility has been packaged in Ubuntu.  It can be installed with the following command: <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><pre><span class="anchor" id="line-1"></span> #&gt; sudo apt-get install linux-crashdump</pre><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span></li></ul><p class="line862">Newer versions of the package will automatically add an entry <em>crashkernel=384M-2G:64M,2G-:128M</em> to the kernel commandline in grub. However this may cause problems on systems with less than 2G of memory (see <a href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe#Troubleshooting">troubleshooting</a>). <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span></p><p class="line874">On
 boot this should automatically load the kernel used to boot as the 
secondary kernel used for crash dumps. Whether a kernel is loaded or not
 can be verified by checking the value of: <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><pre><span class="anchor" id="line-1-1"></span> #&gt; cat /sys/kernel/kexec_crash_loaded</pre><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></li></ul><p class="line862">If the returned value is <em>1</em> the crash kernel has been loaded, if it is <em>0</em>, then something went wrong. The crash kernel can also be loaded by running: <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><pre><span class="anchor" id="line-1-2"></span> #&gt; sudo /etc/init.d/kdump start</pre><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span></li></ul><p class="line862">Starting
 with 13.04 Raring, the same behavior can be achieved by using the new 
kdump-tools mechanism after modifying /etc/default/kdump-tools by 
running (see <a href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe#Release_specific_notes">Release specific notes</a>) : <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><pre><span class="anchor" id="line-1-3"></span> #&gt; sudo kdump-config load</pre><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span></li></ul><p class="line867">
</p><h2 id="Causing_a_test_crash">Causing a test crash</h2>
<span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line862">In order to test a crash, the simplest way is to use the sysrq mechanism. Causing a crash is done by either pressing <em>&lt;sysrq&gt;+c</em> or <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><pre><span class="anchor" id="line-1-4"></span> #&gt; echo c | sudo tee /proc/sysrq-trigger</pre><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></li></ul><p class="line867"><img alt="Warning /!\" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/icon_eek.png" title="Warning /!\" height="16" width="16"> Note that this might be disabled in some releases. <em>/proc/sys/kernel/sysrq</em> needs to be set to 1 in order to let all of the sysrq keys work. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></p><p class="line862">If
 everything works, there should be some delay (depending on the memory 
size). Then the system reboots again into the normal mode. Usually <em>apport</em> kicks in and asks about reporting the issue. Alternatively the report file can be found under <em>/var/crash</em> and either placed somewhere else or be unpacked again by calling: <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><pre><span class="anchor" id="line-1-5"></span> #&gt; apport-unpack &lt;report file&gt; &lt;target directory&gt;</pre><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span></li></ul><p class="line867">
</p><h2 id="Inspecting_the_crash_dump">Inspecting the crash dump</h2>
<span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867">
</p><h3 id="Using_crash">Using crash</h3>
<span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><p class="line862">In order to use the generated crash dump with <strong>crash</strong> one needs the <em>vmlinux</em> file which has the debugging information. This is part of the kernel ddeb package which can be found at: <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></p><p class="line867"><a class="http" href="http://ddebs.ubuntu.com/pool/main/l/linux/">http://ddebs.ubuntu.com/pool/main/l/linux/</a> <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span></p><p class="line867"><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span></p><pre><span class="anchor" id="line-1-6"></span>sudo tee /etc/apt/sources.list.d/ddebs.list &lt;&lt; EOF
<span class="anchor" id="line-2"></span>deb http://ddebs.ubuntu.com/ $(lsb_release -cs)          main restricted universe multiverse
<span class="anchor" id="line-3"></span>deb http://ddebs.ubuntu.com/ $(lsb_release -cs)-security main restricted universe multiverse
<span class="anchor" id="line-4"></span>deb http://ddebs.ubuntu.com/ $(lsb_release -cs)-updates  main restricted universe multiverse
<span class="anchor" id="line-5"></span>deb http://ddebs.ubuntu.com/ $(lsb_release -cs)-proposed main restricted universe multiverse
<span class="anchor" id="line-6"></span>EOF
<span class="anchor" id="line-7"></span>
<span class="anchor" id="line-8"></span>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ECDCAD72428D7C01
<span class="anchor" id="line-9"></span>sudo apt-get update
<span class="anchor" id="line-10"></span>sudo apt-get install linux-image-$(uname -r)-dbgsym</pre><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867"><img alt="Warning /!\" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/icon_eek.png" title="Warning /!\" height="16" width="16"> Be aware that those packages are huge! (~600 MB) <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span></p><p class="line862">When installed, the debug kernel can be found under <em>/usr/lib/debug/boot/</em> and <strong>crash</strong> is started by: <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><pre><span class="anchor" id="line-1-7"></span> #&gt; crash &lt;debug kernel&gt; &lt;crash dump&gt;</pre><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span></li></ul><p class="line874">Unfortunately
 the tool does not allow to look at a 32bit dump on a 64bit system and 
the other way round. Also it tends to be quite picky about matching up 
kernel and dump. <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><p class="line867">
</p><h3 id="Using_apport-retrace">Using apport-retrace</h3>
<span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line874">To get a local retrace, you need apport-retrace and then run: <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><pre><span class="anchor" id="line-1-8"></span> #&gt; apport-retrace --stdout --rebuild-package-info /var/crash/linux-image*.crash</pre><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></li></ul><p class="line867"><img alt="Warning /!\" src="Kernel_CrashdumpRecipe%20-%20Ubuntu%20Wiki_files/icon_eek.png" title="Warning /!\" height="16" width="16"> Again, this can take a while because it needs to download the kernel debug package. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span></p><p class="line867">
</p><h2 id="Troubleshooting">Troubleshooting</h2>
<span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line867">
</p><h3 id="Allocated_memory_for_the_crash_kernel">Allocated memory for the crash kernel</h3>
<span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line874">When
 testing crash dump sometimes the system just seems to lock up. The main
 issue there is how much memory was assigned for the crash kernel. When 
kexec starts the crash kernel it requires enough memory to fit the 
unpacked kernel, the compressed initrd and the uncompressed initrd (at 
least while unpacking). If there is not enough memory allocated, things 
usually go wrong without any hint. To solve this there are the following
 options: <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span></p><ol type="1"><li><p class="line862">Increase the allocation by changing <em>crashkernel=</em> on the grub command line or in <em>/boot/grub/grub.cfg</em> (for grub2) or <em>/boot/grub/menu.lst</em> (for old grub). To avoid loosing the settings when running <strong>update-grub</strong> the change can be made in <em>/etc/grub.d/10_linux</em>. <span class="anchor" id="line-99"></span></p></li><li><p class="line862">Reduce
 the size of the initrd. By default this is set to include all the 
modules and firmware ever needed. This allows using the same initrd on 
any system but increases its size a lot. In order to limit it to the 
modules really required to boot on the current hardware, change the 
following in <em>/etc/initramfs-tools/initramfs.conf</em>:<br>
 <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span></p><pre><span class="anchor" id="line-1-9"></span> ...
<span class="anchor" id="line-2-1"></span> MODULES=dep
<span class="anchor" id="line-3-1"></span> ...</pre><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li></ol><p class="line867">
</p><h3 id="Crash_kernel_fails_to_load:_Hang">Crash kernel fails to load: Hang</h3>
<span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line862">This
 can be frustrating to debug, especially if you're unable to record the 
console messages from the new kexec kernel. A serial console attached to
 the system is best here to continue debugging. An easy troubleshooting 
step is to systematically eliminate the additional kernel parameters 
passed to the crash kernel and retrying. These arguments are kept in <strong>/etc/init.d/kdump</strong>, <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></p><p class="line867"><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></p><pre><span class="anchor" id="line-1-10"></span>...
<span class="anchor" id="line-2-2"></span>        # Append kdump_needed for initramfs to know what to do, and add
<span class="anchor" id="line-3-2"></span>        # maxcpus=1 to keep things sane.
<span class="anchor" id="line-4-1"></span>        APPEND="$APPEND kdump_needed maxcpus=1 irqpoll reset_devices"
<span class="anchor" id="line-5-1"></span>
<span class="anchor" id="line-6-1"></span>        # --elf32-core-headers is needed for 32-bit systems (ok
<span class="anchor" id="line-7-1"></span>        # for 64-bit ones too).
<span class="anchor" id="line-8-1"></span>        log_action_begin_msg "Loading crashkernel"
<span class="anchor" id="line-9-1"></span>        kexec -p "$KERNEL_IMAGE" --initrd="$INITRD" --append="$APPEND"
<span class="anchor" id="line-10-1"></span>        log_action_end_msg $?
<span class="anchor" id="line-11"></span>...</pre><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line862">Leave <strong>$APPEND</strong> and <strong>kdump_needed</strong>. Start by removing <strong>reset_devices</strong> and then <span class="anchor" id="line-125"></span>install the new kexec crash kernel configuration. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></p><p class="line867"><tt>&nbsp;sudo&nbsp;service&nbsp;kdump&nbsp;start&nbsp;</tt> <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></p><p class="line874">Then retest; if that doesn't work, remove the next argument, rinse and repeat. <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span></p><p class="line867">
</p><h1 id="Release_specific_notes">Release specific notes</h1>
<span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line867">
</p><h2 id="Ubuntu_13.04_.22Raring_Ringtail.22">Ubuntu 13.04 "Raring Ringtail"</h2>
<span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><ul><li>linux-crashdump now installs and uses kdump-tools by default <span class="anchor" id="line-136"></span></li><li>kdump-tools
 / makedumpfile have been modified to generate a .dmesg file along with 
the normal .dump files in a timestamped directory under /var/crash <span class="anchor" id="line-137"></span></li><li>apport has been modified to use the .dmesg file <span class="anchor" id="line-138"></span></li><li>apport generates a .crash report with a timestamp <span class="anchor" id="line-139"></span></li><li>Example of output in /var/crash: <span class="anchor" id="line-140"></span><ul><li>linux-image-3.8.0-6-generic-201303201337.crash <span class="anchor" id="line-141"></span><ul><li>crash report generated by apport                                                                     <span class="anchor" id="line-142"></span></li></ul></li><li>/var/crash/201303201337 <span class="anchor" id="line-143"></span><ul><li>content of latest crash <span class="anchor" id="line-144"></span></li></ul></li><li>/var/crash/201303201337/dump.201303201337 <span class="anchor" id="line-145"></span><ul><li>will not be bundled into the apport report, contains vmcore file for use with crash and other utilities <span class="anchor" id="line-146"></span></li></ul></li><li>/var/crash/201303201337/dmesg.201303201337 <span class="anchor" id="line-147"></span><ul><li style="list-style-type:none">content on kernel ring buffer before crash with backtrace <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span></li></ul></li></ul></li></ul><p class="line867">
</p><h2 id="Ubuntu_12.10_.22Quantal_Quetzal.22">Ubuntu 12.10 "Quantal Quetzal"</h2>
<span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><ul><li><p class="line891"><span class="strike"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/kexec-tools/+bug/988512">Bug #988512: Missing /boot/vmcoreinfo-{version} file is breaking kdump</a></span><br>
 <span class="anchor" id="line-152"></span>Because of some kernel code 
changes, the vmcoreinfo file cannot be generated. However, the required 
information can now be obtained from the kernel on doing the dump. But 
the scripts to load the crash kernel and to create the dump still depend
 on it (see the no-vmcoreinfo patch in the bug report). <span class="anchor" id="line-153"></span></p></li><li><p class="line891"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/kexec-tools/+bug/785394">Bug 785394: Hard-coded crashkernel=... memory reservation in /etc/grub.d/10_linux is insufficient</a><br>
 <span class="anchor" id="line-154"></span>The default allocation for 
systems below 2G is not enough for the current initrd size. Manually 
adapting the size allows to use the crash kernel. <span class="anchor" id="line-155"></span></p></li><li>The current (1.4.3-1) version of makedumpfile reports to be incompatible with the 3.2 kernel. The dumps created seem to be ok. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span></li></ul><p class="line867">
</p><h2 id="Ubuntu_12.04_.22Precise_Pangolin.22">Ubuntu 12.04 "Precise Pangolin"</h2>
<span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><ul><li><p class="line891"><span class="strike"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/kexec-tools/+bug/988512">Bug #988512: Missing /boot/vmcoreinfo-{version} file is breaking kdump</a></span><br>
 <span class="anchor" id="line-160"></span>Because of some kernel code 
changes, the vmcoreinfo file cannot be generated. However, the required 
information can now be obtained from the kernel on doing the dump. But 
the scripts to load the crash kernel and to create the dump still depend
 on it (see the no-vmcoreinfo patch in the bug report). <span class="anchor" id="line-161"></span></p></li><li><p class="line891"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/kexec-tools/+bug/785394">Bug 785394: Hard-coded crashkernel=... memory reservation in /etc/grub.d/10_linux is insufficient</a><br>
 <span class="anchor" id="line-162"></span>The default allocation for 
systems below 2G is not enough for the current initrd size. Manually 
adapting the size allows to use the crash kernel. <span class="anchor" id="line-163"></span></p></li><li>The current (1.3.7-2) version of makedumpfile reports to be incompatible with the 3.2 kernel. The dumps created seem to be ok. <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span></li></ul><p class="line867">
</p><h2 id="Ubuntu_10.04_.22Lucid_Lynx.22">Ubuntu 10.04 "Lucid Lynx"</h2>
<span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><ul><li><p class="line891"><span class="strike"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/533565">Bug #533565 in apport (Ubuntu): "Strings missing from the apport template"</a></span><br>
 <span class="anchor" id="line-169"></span><em>This bug was fixed in the package python-distutils-extra - 2.19</em> (in lucid it's 2.18bzr1) <span class="anchor" id="line-170"></span></p></li><li><p class="line891"><a class="https" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/592239">Bug #592239 in apport (Ubuntu): "apport-retrace - IndexError: list index out of range"</a> <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span></p></li></ul><p class="line867">
</p><h2 id="Ubuntu_9.04_.22Jaunty_Jackalope.22">Ubuntu 9.04 "Jaunty Jackalope"</h2>
<span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line874">This
 page describes a recipe for enabling crash dump vmcore analysis on your
 Jaunty x86/x86_64 platform. Much of the information was gleaned from 
the kernel source tree files in Documentation/kdump. <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span></p><ul><li>'apt-get install linux-crashdump' <span class="anchor" id="line-177"></span><ul><li style="list-style-type:none">This is a meta package that installs all of the tools necessary to acquire and analyse a crash-dump vmcore. <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span></li></ul></li><li class="gap">Add 'crashkernel=64M@16M' to the kernel command line in /boot/grub/menu.lst. <span class="anchor" id="line-180"></span><ul><li style="list-style-type:none">You'll also probably want to remove 'quiet splash'. <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></li></ul></li><li class="gap">Reboot
 the system (into the ordinary kernel). The section of RAM above will 
now be    reserved for the crashkernel (and not available to the normal 
system). <span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span></li><li class="gap">Make note of your root partition, e.g., /dev/sda1 <span class="anchor" id="line-185"></span><ul><li style="list-style-type:none"><p class="line891"><strong>kexec -p /boot/vmlinuz-<tt>`uname&nbsp;-r`</tt> --initrd=/boot/initrd.img-<tt>`uname&nbsp;-r`</tt> --append="root=&lt;ROOT_PARTITION&gt; irqpoll maxcpus=1"</strong> <span class="anchor" id="line-186"></span>This loads the crash-dump kernel into the reserved memory, in preparation for a panic. <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span></p></li></ul>Now your kernel is ready to acquire a post-crash vmcore. <span class="anchor" id="line-189"></span></li></ul><span class="anchor" id="bottom"></span></div> <!-- BEGIN FOOTER -->
<div id="pagebottom"></div>
</div>


        <div class="entry-utility"> 
            <span class="cat-links">
<p id="pageinfo" class="info" dir="ltr" lang="en">Kernel/CrashdumpRecipe  (last edited 2013-06-06 19:04:43 by <span title="arges @ cpe-66-68-155-223.austin.res.rr.com[66.68.155.223]"><a class="interwiki" href="https://launchpad.net/%7Earges" title="arges @ cpe-66-68-155-223.austin.res.rr.com[66.68.155.223]">arges</a></span>)</p>

</span> 
        </div> 
    </div><!-- .post --> 
 
            </div><!-- #content --> 
        </div><!-- #container --> 
        <div class="clearBoth"></div> 
    </div><!-- #main --> 
</div><!-- #wrapper .hfeed --> 
    
<div id="footer"> 
    <div id="siteinfo">        
        <p> The material on this wiki is available under a free license, see 
	<a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details.
        </p> 
    </div><!-- #siteinfo --> 
</div><!-- #footer --> 


</body></html>