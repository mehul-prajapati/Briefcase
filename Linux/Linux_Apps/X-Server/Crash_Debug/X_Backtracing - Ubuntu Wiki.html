<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>X/Backtracing - Ubuntu Wiki</title>
<script type="text/javascript" src="X_Backtracing%20-%20Ubuntu%20Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="X_Backtracing%20-%20Ubuntu%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="X_Backtracing%20-%20Ubuntu%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="X_Backtracing%20-%20Ubuntu%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="X_Backtracing%20-%20Ubuntu%20Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://wiki.ubuntu.com/Home">
<link rel="Alternate" title="Wiki Markup" href="https://wiki.ubuntu.com/X/Backtracing?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://wiki.ubuntu.com/X/Backtracing?action=print">
<link rel="Up" href="https://wiki.ubuntu.com/X">
<link rel="Search" href="https://wiki.ubuntu.com/FindPage">
<link rel="Index" href="https://wiki.ubuntu.com/TitleIndex">
<link rel="Glossary" href="https://wiki.ubuntu.com/WordIndex">
<link rel="Help" href="https://wiki.ubuntu.com/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">

<!-- BEGIN HEADER -->
<div id="wrapper" class="hfeed">
<div id="header">
    <ul id="mothership">
        <li> <a href="http://www.ubuntu.com/partners">Partners</a> </li>
        <li> <a href="http://www.ubuntu.com/support">Support</a> </li>
        <li> <a href="http://www.ubuntu.com/community">Community</a> </li>
        <li> <a href="http://www.ubuntu.com/">Ubuntu.com</a> </li>
    </ul>

    <div id="orangeHeader">
        <h1> <a href="https://wiki.ubuntu.com/" title="Ubuntu Wiki"><span>Ubuntu Wiki</span></a> </h1>
            <div id="search-box">

<form id="searchform" method="get" action="/X/Backtracing">
<div>
<input name="action" value="fullsearch" type="hidden">
<input name="context" value="180" type="hidden">
<label style="display: none;" for="searchinput">Search:</label>
<input class="disabled" id="searchinput" name="value" value="Search" size="20" onfocus="searchFocus(this)" onblur="searchBlur(this)" onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search" type="text">
<input disabled="disabled" id="titlesearch" name="titlesearch" value="Titles" alt="Search Titles" type="submit">
<input disabled="disabled" id="fullsearch" name="fullsearch" value="Text" alt="Search Full Text" type="submit">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>


            </div>
    </div>

</div>
    <div id="wikinav"> 
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li><a class="nbinfo" href="https://wiki.ubuntu.com/X/Backtracing?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="https://wiki.ubuntu.com/X/Backtracing?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/X/Backtracing">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) &amp;&amp;
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option selected="selected" value="show">More Actions:</option><option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="RenamePage" disabled="disabled" class="disabled">Rename Page</option>
<option value="CopyPage">Copy Page</option>
<option value="DeletePage" disabled="disabled" class="disabled">Delete Page</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Subscribe User</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Remove Spam</option>
<option value="show" disabled="disabled" class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="SyncPages">Sync Pages</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="username">
<li><a href="https://wiki.ubuntu.com/Home">Ubuntu Wiki</a></li>
<li><a href="https://wiki.ubuntu.com/X/Backtracing?action=login">Login</a></li>
<li><a href="https://wiki.ubuntu.com/HelpContents">Help</a></li>
</ul>

        <hr class="clearBoth">
    </div>
    
	<div id="main"> 
		<div id="container">
			<div id="content">
		<h2 class="entry-title"> 
<span><a href="https://wiki.ubuntu.com/X/Backtracing">Backtracing</a></span>
</h2>
	<div class="hentry post">
               

<div id="page" dir="ltr" lang="en">

<!-- END HEADER --><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><div><table style="font-size: 0.9em;  background:#F1F1ED; margin: 0 0 1em 1em;"><tbody><tr>  <td style="padding:2.0em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Apport_-_Or_debugging_the_easy_way">Apport - Or debugging the easy way</a></li><li>
<a href="#A.22Crash.22...._or_.22Freeze.22.3F">"Crash".... or "Freeze"?</a></li><li>
<a href="#Debug_symbol_information">Debug symbol information</a></li><li>
<a href="#Log_in_remotely">Log in remotely</a></li><li>
<a href="#Backtrace_with_gdb">Backtrace with gdb</a></li><li>
<a href="#Untrap_signals">Untrap signals</a></li><li>
<a href="#Debugging_Error_Exits">Debugging Error Exits</a></li><li>
<a href="#Debugging_Hangs_.2BAC8_Freezes_.2BAC8_Lockups">Debugging Hangs / Freezes / Lockups</a></li><li>
<a href="#DRI_.2BAC8_drm_problems">DRI / drm problems</a></li><li>
<a href="#Xorg_Memory_Usage">Xorg Memory Usage</a></li><li>
<a href="#Backtracing_Using_LiveCD">Backtracing Using LiveCD</a></li><li>
<a href="#Using_Screen_to_get_backtraces_for_Suspend.2BAC8-Resume_crashes">Using Screen to get backtraces for Suspend/Resume crashes</a></li><li>
<a href="#Obtaining_the_video_BIOS">Obtaining the video BIOS</a></li><li>
<a href="#More_information">More information</a></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line874">Some tips for debugging the X server. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span></p><p class="line867">
</p><h2 id="Apport_-_Or_debugging_the_easy_way">Apport - Or debugging the easy way</h2>
<span class="anchor" id="line-7"></span><p class="line862">Since <a href="https://wiki.ubuntu.com/IntrepidIbex">Intrepid Ibex</a> it should be easily possible to get a full X backtrace with <a href="https://wiki.ubuntu.com/Apport">Apport</a>
 which also attaches all other needed information to a new bug report 
like xorg.conf, Xorg.0.log and so on. One of the advantages is that for 
debugging no second computer is needed and no extra package 
installation. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><p class="line874">By
 default Apport is disabled in stable Ubuntu releases, so you may need 
to activate it temporarily (this command works on Karmic and later 
releases): <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></p><pre><span class="anchor" id="line-1"></span>sudo service apport start force_start=1</pre><span class="anchor" id="line-13"></span><p class="line862">Reproduce
 the crash as soon as Apport is running.  Afterwards, a message should 
appear in the Gnome/KDE Panel (at least after a logout/in) as described 
in the <a href="https://wiki.ubuntu.com/Apport">Apport-Wikipage</a>.  You can create new bug report with this message. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line874">If Apport isn't able to create a backtrace, or you're running an older Ubuntu version, the following steps are needed: <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><p class="line867">
</p><h2 id="A.22Crash.22...._or_.22Freeze.22.3F">"Crash".... or "Freeze"?</h2>
<span class="anchor" id="line-18"></span><p class="line874">Some "crashes" are not really crashes (segmentation violations) but are instead what we call "Freezes" (or, "GPU lockups"). <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span></p><p class="line862">In
 a "freeze", the system will stop responding to input, you may see a 
blank/black screen or corruption, or just no graphical updates.  If you 
have a freeze rather than a crash, collecting a backtrace won't be of 
help.  Instead refer to the <a class="https" href="https://wiki.ubuntu.com/X/Troubleshooting/Freeze">troubleshooting guides for freezes</a> for your graphics driver. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></p><p class="line874">In
 a true crash, X will terminate and drop back to a login screen.  You 
can use the steps on this page to debug or report these kinds of issues.
 <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></p><p class="line867">
</p><h2 id="Debug_symbol_information">Debug symbol information</h2>
<span class="anchor" id="line-25"></span><p class="line862">You will likely need to install the package <tt>xserver-xorg-core-dbg</tt>, <tt>libgl1-mesa-dri-dbg</tt> and the one for your graphic driver <tt>xserver-xorg-video-&lt;name&gt;-dbg</tt>.
  Often you'll want dbg packages for other libraries or packages 
mentioned in your backtrace.  Look for lines marked '??' which indicate 
missing symbols. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><p class="line867">
</p><h2 id="Log_in_remotely">Log in remotely</h2>
<span class="anchor" id="line-28"></span><p class="line862">You will 
want to run the commands in a terminal window on another computer since 
you will not have access to the local screen and keyboard. This is 
explained in <a class="https" href="https://help.ubuntu.com/community/DebuggingSystemCrash">DebuggingSystemCrash</a>, but essentially just ssh into the sick machine from a well one. <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span></p><p class="line867">
</p><h2 id="Backtrace_with_gdb">Backtrace with gdb</h2>
<span class="anchor" id="line-31"></span><p class="line874">Logged in 
remotely on your "sick" machine, you can now run the gdb debugger on the
 X server process. First, find the process ID (pid) of Xorg: <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span></p><pre><span class="anchor" id="line-1-1"></span>pgrep Xorg</pre><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line874">Then start gdb and attach to that process: <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></p><pre><span class="anchor" id="line-1-2"></span>sudo gdb /usr/bin/Xorg 2&gt;&amp;1 | tee gdb-Xorg.txt</pre><span class="anchor" id="line-40"></span><p class="line874">(gdb starts up and gives you its (gdb) prompt) <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></p><pre><span class="anchor" id="line-1-3"></span>(gdb) attach &lt;the process ID you found above&gt;
<span class="anchor" id="line-2"></span>(gdb) cont</pre><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line874">Now
 do what you need to make the X server crash. Or, if the problem is that
 the X server is locked up and doesn't react, stop it with ctrl-C. Now 
get a backtrace: <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></p><pre><span class="anchor" id="line-1-4"></span>(gdb) backtrace full</pre><span class="anchor" id="line-50"></span><p class="line862">See also <a href="https://wiki.ubuntu.com/Backtrace">Backtrace</a> for more information on this. Note that if the process is already running, you should use the <tt>attach</tt> <em>pid</em> command instead of <tt>run</tt>. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></p><p class="line862">You can now find the output of gdb in /home/&lt;username&gt;/gdb-Xorg.txt <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><p class="line862">You can do a lot of stuff with gdb. See the <a class="http" href="http://sourceware.org/gdb/onlinedocs/gdb.html">gdb documentation</a> or for instance <a class="http" href="http://www-128.ibm.com/developerworks/library/l-gdb/">one tutorial</a> out of many. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></p><p class="line862">If you stopped it with ctrl-C, you can let it run again with the <em>continue</em> command: <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span></p><pre><span class="anchor" id="line-1-5"></span>(gdb) cont</pre><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line867">
</p><h3 id="gdb_problems">gdb problems</h3>
<span class="anchor" id="line-62"></span><p class="line862">gdb and Xorg don't always work well together. It may help to start Xorg with the options <tt>-keeptty&nbsp;-dumbSched</tt> <span class="anchor" id="line-63"></span></p><ul><li><p class="line891"><em>keeptty</em> allows you to ^C to get into gdb at anytime <span class="anchor" id="line-64"></span></p></li><li><p class="line891"><em>dumpSched</em> stops the smart scheduler interrupting each time you step <span class="anchor" id="line-65"></span></p></li></ul><p class="line874">For instance, to start Xorg from within gdb (over a ssh connection), start gdb: <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span></p><pre><span class="anchor" id="line-1-6"></span>sudo gdb /usr/bin/Xorg 2&gt;&amp;1 | tee gdb-Xorg.txt</pre><span class="anchor" id="line-69"></span><p class="line874">inside gdm, start up Xorg: <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></p><pre><span class="anchor" id="line-1-7"></span>(gdb) run -keeptty -dumbSched</pre><span class="anchor" id="line-73"></span><p class="line862">(<a class="http" href="http://lists.freedesktop.org/archives/xorg/2007-July/026404.html">posted</a> by Barry Scott on the xorg ML) <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></p><p class="line867">
</p><h3 id="Post-mortem_backtrace">Post-mortem backtrace</h3>
<span class="anchor" id="line-76"></span><p class="line874">If the 
server has died and dumped a core dump, and you're using the current 
development version of Ubuntu, apport can be used for filing the bug.  
It should automatically prompt you to file a bug. <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span></p><p class="line874">Otherwise,
 if apport doesn't do it automatically, you can get a backtrace 
manually. Locate the core dump (usually in /etc/X11/core) and run <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><pre><span class="anchor" id="line-1-8"></span>sudo gdb /usr/bin/Xorg /etc/X11/core</pre><span class="anchor" id="line-82"></span><p class="line874">Then run the "backtrace full" command inside gdb. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span></p><p class="line862">If you can't find any core files after a crash, look also in /var/crash, where <em>apport</em> (the automatic crash reporter) leaves its reports. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span></p><p class="line874">Another
 problem can be that the default maximum size of core files has been set
 to 0. To avoid this limitation, run ulimit (in the same shell) before 
restarting the X server. Don't restart gdm as it seems to enforce soft 
core limit to zero. Use startx instead: <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></p><pre><span class="anchor" id="line-1-9"></span>sudo /etc/init.d/gdm stop
<span class="anchor" id="line-2-1"></span>ulimit -c unlimited
<span class="anchor" id="line-3"></span>startx</pre><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line867">
</p><h2 id="Untrap_signals">Untrap signals</h2>
<span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line874">The
 X server will by default intercept signals and for instance trap its 
own crashes and dump a stack trace in /var/log/Xorg.0.log. However, this
 stack trace is modified by the signal handler itself. To disable this 
signal interception, add this to your /etc/X11/xorg.conf: <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span></p><pre><span class="anchor" id="line-1-10"></span>Section "ServerFlags"
<span class="anchor" id="line-2-2"></span>        Option "NoTrapSignals" "true"
<span class="anchor" id="line-3-1"></span>EndSection</pre><span class="anchor" id="line-101"></span><p class="line874">and
 restart your X server. It is sometimes restarted when logging out, but 
you can also switch to a text console with Ctrl-Alt-F1, log in and run: <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span></p><pre><span class="anchor" id="line-1-11"></span>sudo /etc/init.d/gdm restart</pre><span class="anchor" id="line-105"></span><p class="line874">You can also run this command remotely, in case you have trouble with your text consoles etc. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span></p><p class="line867">
</p><h2 id="Debugging_Error_Exits">Debugging Error Exits</h2>
<span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line874">Much
 like a crash, the X server can terminate normally on an error.  Since 
it terminated normally, you can't get a backtrace.  However, typically 
an error will be printed on the console (but not in 
/var/log/Xorg.0.log).  To look for the error message, look at the log 
files at /var/log/gdm/.  If you just reproduced the crash it will be in 
:0.log; if it was the boot before that, look in :0.log.1. <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span></p><p class="line874">Alternatively,
 it is not hard to view the exit messages directly.  Login at a vt 
console or through ssh and start up X manually without gdm (or kdm): <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span></p><p class="line867"><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span></p><pre><span class="anchor" id="line-1-12"></span>sudo /etc/init.d/gdm stop
<span class="anchor" id="line-2-3"></span>startx</pre><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><p class="line874">Now do whatever triggered the fault, and then look at the console output to see the error message. <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span></p><p class="line867">
</p><h2 id="Debugging_Hangs_.2BAC8_Freezes_.2BAC8_Lockups">Debugging Hangs / Freezes / Lockups</h2>
<span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line874">Hangs
 (aka freezes or lockups) differ from crashes or exits.  In a crash, the
 server terminates at a specific point which can be backtraced.  Hangs 
do not result in server termination, so the spot where the fault 
occurred is harder to isolate and identify, but with some persistence 
and gdb-fu you can find it manually. <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span></p><p class="line862">First, start by finding a point in the code near where the error occurs.  If you're lucky, one way to do this is to <tt>tail&nbsp;-f&nbsp;/var/log/Xorg.0.log</tt>
 from an ssh session and watch for what prints out immediately before 
the lockup.  Then find the spot in the codebase where that message gets 
printed. <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span></p><p class="line874">If you're not lucky, you'll need to make some guesses, or just pick a random spot. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span></p><p class="line874">Next, set a breakpoint in gdb: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span></p><p class="line867"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span></p><pre><span class="anchor" id="line-1-13"></span> (gdb) break &lt;function-name&gt;</pre><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line874">Now run X until it hits the breakpoint and then start stepping through it until the fault occurs. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span></p><p class="line867"><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></p><pre><span class="anchor" id="line-1-14"></span> (gdb) run &lt;args&gt;
<span class="anchor" id="line-2-4"></span>...runs until hits the breakpoint...
<span class="anchor" id="line-3-2"></span> (gdb) step
<span class="anchor" id="line-4"></span> (gdb) step
<span class="anchor" id="line-5"></span>...</pre><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><p class="line874">Note
 that this can be tedious!  As you do it, look for additional spots to 
set breakpoints so you can skip over stepping through code you know 
isn't involved. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span></p><p class="line867">
</p><h2 id="DRI_.2BAC8_drm_problems">DRI / drm problems</h2>
<span class="anchor" id="line-147"></span><p class="line862">More verbose debugging information can be obtained by enabling the debug option of the <em>drm</em> kernel module: <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></p><pre><span class="anchor" id="line-1-15"></span>echo 1 | sudo tee /sys/module/drm/parameters/debug</pre><span class="anchor" id="line-151"></span><p class="line874">Note
 that leaving this option on will generate a lot of messages in your 
/var/log/kern.log and /var/log/syslog! To turn it off again: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span></p><pre><span class="anchor" id="line-1-16"></span>echo 0 | sudo tee /sys/module/drm/parameters/debug</pre><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867">
</p><h2 id="Xorg_Memory_Usage">Xorg Memory Usage</h2>
<span class="anchor" id="line-158"></span><p class="line862">If you 
notice Xorg is using large amounts of memory, you can get a better 
indication of the server-side resource usage of X's client apps via the 
top-like <em>xrestop</em> program.  For reporting issues, the <em>xrestop -b</em> option is handy.  For example, <em>xrestop -b -m 5 | grep -A 15 metacity</em> would print 5 samples of resource usage of the window manager, taken 2 seconds apart. <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></p><p class="line867">
</p><h2 id="Backtracing_Using_LiveCD">Backtracing Using LiveCD</h2>
<span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line874">Generally
 upstream is most responsive if the bug can be verified in a new version
 of their code, but you may not be in a position to upgrade to the 
latest versions and prefer to do the testing using a temporary LiveCD 
environment.  Here are tips for doing this: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span></p><p class="line874">1.  Burn a CD of the latest development version of Ubuntu, using either: <span class="anchor" id="line-166"></span></p><ul><li><p class="line862">Latest alpha releases images: <a class="http" href="http://cdimage.ubuntu.com/releases/">http://cdimage.ubuntu.com/releases/</a> <span class="anchor" id="line-167"></span></p></li><li><p class="line862">Latest daily images: <a class="http" href="http://cdimage.ubuntu.com/daily-live/current/">http://cdimage.ubuntu.com/daily-live/current/</a> <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span></p></li></ul><p class="line874">2.  Boot the LiveCD environment <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span></p><p class="line862">3.  If X is failing to run as normal, switch to a virtual terminal (VT), via <strong>ctrl-alt-F1</strong> and log in <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></p><p class="line874">4.  Turn on the ssh server, so you can log in remotely <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></p><pre><span class="anchor" id="line-1-17"></span> $ sudo apt-get install ssh
<span class="anchor" id="line-2-5"></span> $ sudo /etc/init.d/ssh start
<span class="anchor" id="line-3-3"></span>  * Starting OpenBSD Secure Shell server sshd [ OK ] </pre><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line874">5.  Make any configuration changes needed. <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></p><p class="line874">6.  Restart X (without doing a full reboot) using any of the following: <span class="anchor" id="line-183"></span></p><ul><li><p class="line891"><strong>alt-sysrq-k</strong> <span class="anchor" id="line-184"></span></p></li><li><p class="line891"><strong>ctrl-alt-backspace</strong> (pre-jaunty only) <span class="anchor" id="line-185"></span></p></li><li><p class="line891"><tt>/etc/init.d/gdm&nbsp;restart</tt> <span class="anchor" id="line-186"></span></p></li><li><p class="line891"><tt>pkill&nbsp;-9&nbsp;/usr/bin/X</tt> <span class="anchor" id="line-187"></span></p></li><li><p class="line862">See <a href="https://wiki.ubuntu.com/X/NonGraphicalBoot">X/NonGraphicalBoot</a> for more boot options <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p></li></ul><p class="line874">Continue debugging as normal. <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></p><p class="line867">
</p><h2 id="Using_Screen_to_get_backtraces_for_Suspend.2BAC8-Resume_crashes">Using Screen to get backtraces for Suspend/Resume crashes</h2>
<span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line862">When
 resuming from suspend, your ssh sessions will terminate, so the normal 
procedure of running gdb through ssh won't work.  Fortunately, you can 
work around this issue by using a <tt>screen</tt> session. <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span></p><p class="line874">Boot
 computer and login to X. openssh-server must be installed and running, 
and you must know the computer's IP and be able to access it from 
another system on the network. <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span></p><p class="line874">Switch to tty1. Run: <span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span></p><p class="line867"><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span></p><pre><span class="anchor" id="line-1-18"></span>   screen -S xcrash</pre><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line874">You may call the session whatever you want, I called it "xcrash". <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span></p><p class="line874">Now inside the screen session, run: <span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span></p><pre><span class="anchor" id="line-1-19"></span>   pgrep Xorg
<span class="anchor" id="line-2-6"></span>   sudo gdb /usr/bin/Xorg</pre><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line874">Now <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span></p><pre><span class="anchor" id="line-1-20"></span>   (gdb) attach &lt;the process ID you found above&gt;
<span class="anchor" id="line-2-7"></span>   (gdb) handle SIGUSR1 nostop
<span class="anchor" id="line-3-4"></span>   (gdb) cont</pre><span class="anchor" id="line-217"></span><p class="line874">The second line is required in order to be able to switch back to X. <span class="anchor" id="line-218"></span>Now detach from the screen session (<tt>ctrl+a+d</tt>). <span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span></p><p class="line874">Switch
 back to X (usually tty7, sometimes tty9). Activate suspend/standby. 
Wait a few seconds, then pull the system out of suspend. <span class="anchor" id="line-221"></span>Screen is blank. <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span></p><p class="line874">From a remote computer, open an ssh session. Run: <span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><pre><span class="anchor" id="line-1-21"></span>   screen -x xcrash</pre><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line874">Now you have recovered your screen session and you will see some output in gdb. <span class="anchor" id="line-229"></span>Enable logging: <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span></p><pre><span class="anchor" id="line-1-22"></span>   (gdb) set logging on</pre><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line874">Get the backtrace: <span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span></p><pre><span class="anchor" id="line-1-23"></span>   (gdb) backtrace full</pre><span class="anchor" id="line-238"></span><p class="line874">Enter your way through the backtrace. <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span></p><p class="line874">Now open another terminal and grab your log file, this is easiest with scp: <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span></p><pre><span class="anchor" id="line-1-24"></span>   scp:username@ip:gdb.txt .</pre><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><p class="line874">example (not real name/IP) <span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span></p><pre><span class="anchor" id="line-1-25"></span>   scp connor@192.168.1.100:gdb.txt .</pre><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><p class="line874">You now have the gdb.txt file with the backtrace on the machine you made your remote connection from. <span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span></p><p class="line867">
</p><h2 id="Obtaining_the_video_BIOS">Obtaining the video BIOS</h2>
<span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><p class="line874">First obtain the pci id for your video card, by looking at the lspci output. <span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span></p><p class="line874">Next, as root, do the following (replacing the pci bit with your own): <span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span></p><p class="line867"><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span></p><pre><span class="anchor" id="line-1-26"></span># cd /sys/devices/pci0000\:00/0000\:00\:02.0/
<span class="anchor" id="line-2-8"></span># echo 1 &gt; rom
<span class="anchor" id="line-3-5"></span># cat rom &gt; /tmp/rom.bin
<span class="anchor" id="line-4-1"></span># echo 0 &gt; rom</pre><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><p class="line874">Then send the resulting rom.bin <span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span></p><p class="line867">
</p><h2 id="More_information">More information</h2>
<span class="anchor" id="line-270"></span><ul><li><p class="line891"><a class="http" href="http://xorg.freedesktop.org/wiki/Development/Documentation/ServerDebugging">http://xorg.freedesktop.org/wiki/Development/Documentation/ServerDebugging</a> <span class="anchor" id="line-271"></span></p></li><li><p class="line891"><a class="http" href="http://wiki.debian.org/XStrikeForce/XserverDebugging">http://wiki.debian.org/XStrikeForce/XserverDebugging</a> <span class="anchor" id="line-272"></span></p></li></ul><span class="anchor" id="bottom"></span></div> <!-- BEGIN FOOTER -->
<div id="pagebottom"></div>
</div>


        <div class="entry-utility"> 
            <span class="cat-links">
<p id="pageinfo" class="info" dir="ltr" lang="en">X/Backtracing  (last edited 2012-03-07 08:16:46 by <span title="jtv @ 125.24.139.211.adsl.dynamic.totbb.net[125.24.139.211]"><a class="interwiki" href="https://launchpad.net/%7Ejtv" title="jtv @ 125.24.139.211.adsl.dynamic.totbb.net[125.24.139.211]">jtv</a></span>)</p>

</span> 
        </div> 
    </div><!-- .post --> 
 
            </div><!-- #content --> 
        </div><!-- #container --> 
        <div class="clearBoth"></div> 
    </div><!-- #main --> 
</div><!-- #wrapper .hfeed --> 
    
<div id="footer"> 
    <div id="siteinfo">        
        <p> The material on this wiki is available under a free license, see 
	<a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details.
        </p> 
    </div><!-- #siteinfo --> 
</div><!-- #footer --> 


</body></html>