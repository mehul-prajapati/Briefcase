<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>Kernel/Compile - Community Help Wiki</title>
<script type="text/javascript" src="Kernel_Compile%20-%20Community%20Help%20Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="Kernel_Compile%20-%20Community%20Help%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="Kernel_Compile%20-%20Community%20Help%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="Kernel_Compile%20-%20Community%20Help%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="Kernel_Compile%20-%20Community%20Help%20Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://help.ubuntu.com/community/CommunityHelpWiki">
<link rel="Alternate" title="Wiki Markup" href="https://help.ubuntu.com/community/Kernel/Compile?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://help.ubuntu.com/community/Kernel/Compile?action=print">
<link rel="Up" href="https://help.ubuntu.com/community/Kernel">
<link rel="Search" href="https://help.ubuntu.com/community/FindPage">
<link rel="Index" href="https://help.ubuntu.com/community/TitleIndex">
<link rel="Glossary" href="https://help.ubuntu.com/community/WordIndex">
<link rel="Help" href="https://help.ubuntu.com/community/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="http://www.ubuntu.com/partners">Partners</a> </li>
        	    <li><a href="http://www.ubuntu.com/support">Support</a></li>
        	    <li><a href="http://www.ubuntu.com/community">Community</a></li>
        	    <li><a href="http://www.ubuntu.com/">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community">Community Help Wiki</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a href="https://help.ubuntu.com/community/Kernel/Compile?action=login&amp;login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 <form action="http://www.google.com/cse" id="cse-search-box">
   <div>
     <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />
     <input type="hidden" name="ie" value="UTF-8" />
     <input type="text" name="q" size="21" />
     <input type="submit" name="sa" value="Search" />
   </div>
 </form>
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script><form action="https://help.ubuntu.com/search.html" id="cse-search-box">  <div>    <input name="cof" value="FORID:9" type="hidden">    <input name="cx" value="004599128559784038176:vj_p0xo-nng" type="hidden">    <input name="ie" value="UTF-8" type="hidden">    <input name="q" size="21" type="text">    <input name="sa" value="Search" type="submit">  </div></form>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><span class="pagepath"><a href="https://help.ubuntu.com/community/Kernel">Kernel</a></span><span class="sep">/</span><a class="backlink" href="https://help.ubuntu.com/community/Kernel/Compile?action=fullsearch&amp;value=linkto%3A%22Kernel%2FCompile%22&amp;context=180" rel="nofollow" title="Click to do a full-text search for this title">Compile</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear">
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><div><table style="float:right;  font-size: 0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em;"><tbody><tr>  <td style="padding:0.5em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Disclaimer">Disclaimer</a></li><li>
<a href="#Reasons_for_compiling_a_custom_kernel">Reasons for compiling a custom kernel</a></li><li>
<a href="#Reasons_for_NOT_compiling_a_custom_kernel">Reasons for NOT compiling a custom kernel</a></li><li>
<a href="#Tools_you.27ll_need">Tools you'll need</a></li><li>
<a href="#Get_the_kernel_source">Get the kernel source</a><ol><li>
<a href="#A.29_Use_git">A) Use git</a></li><li>
<a href="#B.29_Download_the_source_archive">B) Download the source archive</a></li><li>
<a href="#C.29_Download_the_source_package">C) Download the source package</a></li></ol></li><li>
<a href="#Modify_the_source_for_your_needs">Modify the source for your needs</a></li><li>
<a href="#Build_the_kernel_.28when_source_is_from_git_repository.2C_or_from_apt-get_source.29">Build the kernel (when source is from git repository, or from apt-get source)</a></li><li>
<a href="#Alternate_Build_Method:_The_Old-Fashioned_Debian_Way">Alternate Build Method: The Old-Fashioned Debian Way</a></li><li>
<a href="#Install_the_new_kernel">Install the new kernel</a></li><li>
<a href="#Rebuilding_.27.27linux-restricted-modules.27.27">Rebuilding ''linux-restricted-modules''</a></li><li>
<a href="#Speeding_Up_the_Build">Speeding Up the Build</a></li><li>
<a href="#More_documentation">More documentation</a></li><li>
<a href="#Comments">Comments</a></li><li>
<a href="#External_information">External information</a></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
</p><h2 id="Disclaimer">Disclaimer</h2>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><strong>Building and using a custom kernel will make it very difficult to get support for your system.</strong> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867"><strong>While
 it is a learning experience to compile your own kernel, you will not be
 allowed to file bugs on the custom-built kernel (if you do, they will 
be Rejected without further explanation).</strong> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><p class="line867"><strong>Note: This page would need significant cleaning. You may want to refer to <a class="https" href="https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel">Kernel/BuildYourOwnKernel</a> page in Ubuntu wiki instead which is a cleaner and more up-to-date guide to (simple) kernel building</strong> <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span></p><p class="line874">If you have a commercial support contract with Ubuntu/Canonical, this will void such support. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span></p><p class="line874">Also
 note that this page describes how to do things for the Edgy (2.6.17) 
kernel and newer! Until this kernel source, we did not have any 
mechanisms in place that would allow people to build their own kernels 
easily. This was intentional. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line862">This page does <strong>NOT</strong> describe how to <a class="https" href="https://wiki.ubuntu.com/KernelTeam/GitKernelBuild">build upstream kernels</a> from <tt>kernel.org</tt>. This is how to rebuild the actual Ubuntu kernel starting from source. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><p class="line867">
</p><h2 id="Reasons_for_compiling_a_custom_kernel">Reasons for compiling a custom kernel</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><ul><li>You are a kernel developer. <span class="anchor" id="line-20"></span></li><li>You
 need the kernel compiled in a special way, that the official kernel is 
not compiled in (for example, with some experimental feature enabled). <span class="anchor" id="line-21"></span></li><li>You are attempting to debug a problem in the stock Ubuntu kernel for which you have filed or will file a bug report. <span class="anchor" id="line-22"></span></li><li>You have hardware the stock Ubuntu kernel does not support. <span class="anchor" id="line-23"></span></li><li>You
 love computers and are curious and interested in hacking on your own 
GNU/Linux system to learn more about how it works (with the 
understanding that you'll need to fix anything you break). <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span></li></ul><p class="line867">
</p><h2 id="Reasons_for_NOT_compiling_a_custom_kernel">Reasons for NOT compiling a custom kernel</h2>
<span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><ul><li>You merely need to compile a special driver. For this, you only need to install the linux-headers packages. <span class="anchor" id="line-28"></span></li><li>You
 have no idea what you are doing, and if you break something, you'll 
need help fixing it. Depending on what you do wrong, you might end up 
having to reinstall your system from scratch. <span class="anchor" id="line-29"></span></li><li>You
 got to this page by mistake, and checked it out because it looked 
interesting, but you don't really want to learn a lot about kernels. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span></li></ul><p class="line862">If you want to install a new kernel without compilation, you can use <a href="https://help.ubuntu.com/community/Synaptic">Synaptic</a>, search for <tt>linux-image</tt> and select the kernel version you want to install. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></p><p class="line862">An easier way is to click on <tt>System&nbsp;&gt;&nbsp;Administration&nbsp;&gt;&nbsp;Update&nbsp;Manager</tt>, then click on the <tt>Check</tt> button, and finally click on <tt>Apply&nbsp;all&nbsp;updates</tt> including the kernel. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><p class="line867">
</p><h2 id="Tools_you.27ll_need">Tools you'll need</h2>
<span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">To
 start, you will need to install a few packages. The exact commands to 
install those packages depends on which release you are using: <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></p><p class="line867"><strong> Hardy (8.04): </strong> <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></p><pre><span class="anchor" id="line-1"></span>sudo apt-get install linux-kernel-devel fakeroot kernel-wedge build-essential</pre><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line862">Note: The package <tt>makedumpfile</tt> is not available in Hardy. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></p><p class="line867"><strong> Lucid (10.04): </strong> <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></p><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span></p><pre><span class="anchor" id="line-1-1"></span>sudo apt-get install fakeroot build-essential crash kexec-tools makedumpfile kernel-wedge
<span class="anchor" id="line-2"></span>sudo apt-get build-dep linux
<span class="anchor" id="line-3"></span>sudo apt-get install git-core libncurses5 libncurses5-dev libelf-dev asciidoc binutils-dev</pre><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line867">
</p><h2 id="Get_the_kernel_source">Get the kernel source</h2>
<span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line874">There are a few ways to obtain the Ubuntu kernel source: <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></p><p class="line867">
</p><h3 id="A.29_Use_git">A) Use git</h3>
<span class="anchor" id="line-61"></span><ul><li style="list-style-type:none"><p class="line862">Use <tt>git</tt> (detailed instructions on it can be found in the <a class="interwiki" href="https://wiki.ubuntu.com/KernelTeam/KernelGitGuide" title="Ubuntu">Kernel Git Guide</a>) - This is for users who always want to stay in sync with the latest Ubuntu kernel source. <span class="anchor" id="line-62"></span><br>
<br>
The git repository does not include necessary control files, so you must build them by: <span class="anchor" id="line-63"></span></p></li></ul><p class="line867"><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span></p><pre><span class="anchor" id="line-1-2"></span>fakeroot debian/rules clean</pre><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867">
</p><h3 id="B.29_Download_the_source_archive">B) Download the source archive</h3>
<span class="anchor" id="line-68"></span><ul><li style="list-style-type:none"><p class="line862">Download
 the source archive - This is for users who want to rebuild the standard
 Ubuntu packages with additional patches. Note that this will almost 
always be out of date compared to the latest development source, so you 
should use <tt>git</tt> (option A) if you need the latest patches. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span>To install the build dependencies and extract the source (to the current directory): <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></p><p class="line891"><strong>Ubuntu Hardy (8.04)</strong> <span class="anchor" id="line-73"></span></p></li></ul><p class="line867"><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span></p><pre><span class="anchor" id="line-1-3"></span>sudo apt-get build-dep --no-install-recommends --only-source linux
<span class="anchor" id="line-2-1"></span>apt-get source --only-source linux</pre><span class="anchor" id="line-77"></span><ul><li style="list-style-type:none">Ubuntu
 modules source may also be needed if you plan to enable PAE and 64 GiB 
support in the kernel for 32-bit Hardy (8.04). The Ubuntu supplied 
modules may not be compatible with a PAE enabled kernel. <span class="anchor" id="line-78"></span></li></ul><p class="line867"><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><pre><span class="anchor" id="line-1-4"></span>sudo apt-get build-dep --no-install-recommends linux-ubuntu-modules-$(uname -r)
<span class="anchor" id="line-2-2"></span>apt-get source linux-ubuntu-modules-$(uname -r)</pre><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><ul><li style="list-style-type:none">The source will be downloaded to a subdirectory inside the current directory. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line891"><strong>Ubuntu Karmic Koala (9.10) and newer releases</strong> <span class="anchor" id="line-86"></span></p></li></ul><p class="line867"><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></p><pre><span class="anchor" id="line-1-5"></span>sudo apt-get build-dep --no-install-recommends linux-image-$(uname -r)
<span class="anchor" id="line-2-3"></span>apt-get source linux-image-$(uname -r)</pre><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><ul><li style="list-style-type:none"><p class="line862">The source will be downloaded to the current directory (for Lucid, at least) as a trio of files (<tt>.orig.tar.gz</tt>, <tt>.diff.gz</tt>, and <tt>.dsc</tt>) and a sub-directory. For instance, if <tt>uname&nbsp;-r</tt> returns <tt>2.6.32-25-generic</tt>, you'll obtain <tt>linux_2.6.32.orig.tar.gz</tt>, <tt>linux_2.6.32-25.44.diff.gz</tt>, <tt>linux_2.6.32-25.44.dsc</tt> and the sub-directory <tt>linux-2.6.32</tt>. <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span></p></li></ul><p class="line867">
</p><h3 id="C.29_Download_the_source_package">C) Download the source package</h3>
<span class="anchor" id="line-94"></span><ul><li style="list-style-type:none"><p class="line862">Download the source package (detailed instructions are further down this page under <a href="https://help.ubuntu.com/community/Kernel/Compile#AltBuildMethod">Alternate Build Method: The Old-Fashioned Debian Way</a>)
 - This is for users who simply want to modify, or play around with, the
 Ubuntu-patched kernel source. Again, this will not be the most 
up-to-date (use option A/git if you need the latest source). Please be 
aware this is NOT the same as option B. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span></p></li></ul><p class="line867">
</p><h2 id="Modify_the_source_for_your_needs">Modify the source for your needs</h2>
<span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line874">For
 most people, simply modifying the configs is enough. If you need to 
install a patch, read the instructions from the patch provider to learn 
how to apply it. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span></p><p class="line862">The stock Ubuntu configs are located in <tt>debian/config/ARCH/</tt> where <tt>ARCH</tt> is the architecture you are building for (Starting with Jaunty this is <tt>debian.master/config/ARCH/</tt>). In this directory there are several files. The <tt>config</tt> file is the base for all targets in that architecture. Then there are several <tt>config.FLAVOUR</tt> files that contain options specific to that target. For example, here are the files for 2.6.20, i386: <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span></p><p class="line867"><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span></p><pre><span class="anchor" id="line-1-6"></span>ls -l debian/config/i386/
<span class="anchor" id="line-2-4"></span>total 108
<span class="anchor" id="line-3-1"></span>-rw-r--r-- 1 root src  73962 2007-08-13 01:29 config
<span class="anchor" id="line-4"></span>-rw-r--r-- 1 root root  1369 2007-08-13 01:29 config.386
<span class="anchor" id="line-5"></span>-rw-r--r-- 1 root root  1330 2007-08-13 01:29 config.generic
<span class="anchor" id="line-6"></span>-rw-r--r-- 1 root root  1395 2007-08-13 01:29 config.server
<span class="anchor" id="line-7"></span>-rw-r--r-- 1 root root  1756 2007-08-13 01:29 config.server-bigiron
<span class="anchor" id="line-8"></span>-rw-r--r-- 1 root root     8 2007-08-13 01:25 lowlatency
<span class="anchor" id="line-9"></span>-rw-r--r-- 1 root root   194 2007-08-13 01:25 vars.386
<span class="anchor" id="line-10"></span>-rw-r--r-- 1 root root   218 2007-08-13 01:25 vars.server-bigiron</pre><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867"><strong>If you do not find the config files under <tt>debian/config</tt>, you may find them in your <tt>/boot</tt> directory (for instance, <tt>/boot/config-2.6.22-14-generic</tt>)
 otherwise you should check to see if an alternate location has been 
specified within debian/debian.env of your kernel source directory.</strong> <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></p><p class="line862">If you need to change a config option, simply modify the file that contains the option. If you modify just the <tt>config</tt> file, it will affect all targets for this architecture. If you modify one of the target files, it only affects that target. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span></p><p class="line874">After
 applying a patch, or adjusting the configs, it is always best to 
regenerate the config files to ensure they are consistent. There is a 
helper command for this. To regenerate all architectures run: <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span></p><p class="line867"><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span></p><pre><span class="anchor" id="line-1-7"></span>debian/rules updateconfigs</pre><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line874">If you just want to update one architecture, run: <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></p><p class="line867"><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></p><pre><span class="anchor" id="line-1-8"></span>debian/scripts/misc/oldconfig ARCH</pre><span class="anchor" id="line-130"></span><p class="line862">Note: If you don't have the <tt>debian/</tt> directory after using <tt>apt-get&nbsp;source</tt>, use <tt>dpkg-source&nbsp;-x&nbsp;*dsc</tt> to extract the sources properly. <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span></p><p class="line862">For these two commands to work, you need to give the scripts in the <tt>debian/scripts/misc</tt> and <tt>debian/scripts</tt> directories execute permission with the following command: <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span></p><p class="line867"><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span></p><pre><span class="anchor" id="line-1-9"></span>chmod -R u+x debian/scripts/*</pre><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><p class="line867">
</p><h2 id="Build_the_kernel_.28when_source_is_from_git_repository.2C_or_from_apt-get_source.29">Build the kernel (when source is from git repository, or from apt-get source)</h2>
<span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line874">To
 build the kernel(s) is very simple. Depending on your needs, you may 
want to build all the kernel targets, or just one specific to your 
system. However, you also want to make sure that you do not clash with 
the stock kernels. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></p><p class="line874">Note: <span class="anchor" id="line-143"></span>Though
 these outside instructions include making a separate and unique branch 
of the kernel, unlike here, they include thorough explanations of all 
necessary steps from start to finish. <span class="anchor" id="line-144"></span></p><ul><li><p class="line862">Oneiric (11.10) Kernel 3.2 : <a class="http" href="http://blog.avirtualhome.com/2012/01/13/compile-linux-kernel-3-2-for-ubuntu-11-10/">http://blog.avirtualhome.com/2012/01/13/compile-linux-kernel-3-2-for-ubuntu-11-10/</a> <span class="anchor" id="line-145"></span></p></li><li><p class="line862">Oneiric (11.10) : <a class="http" href="http://blog.avirtualhome.com/2011/10/28/how-to-compile-a-new-ubuntu-11-10-oneiric-kernel/">http://blog.avirtualhome.com/2011/10/28/how-to-compile-a-new-ubuntu-11-10-oneiric-kernel/</a> <span class="anchor" id="line-146"></span></p></li><li><p class="line862">Maverick on Lucid (10.04): <a class="http" href="http://blog.avirtualhome.com/2010/07/14/how-to-compile-a-ubuntu-2-6-35-kernel-for-lucid/">http://blog.avirtualhome.com/2010/07/14/how-to-compile-a-ubuntu-2-6-35-kernel-for-lucid/</a> <span class="anchor" id="line-147"></span></p></li><li><p class="line862">Lucid (10.04): <a class="http" href="http://blog.avirtualhome.com/2010/05/05/how-to-compile-a-ubuntu-lucid-kernel/">http://blog.avirtualhome.com/2010/05/05/how-to-compile-a-ubuntu-lucid-kernel/</a> <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span></p></li></ul><p class="line867"><strong>These instructions are specific to the git-tree and for the source downloaded via <tt>apt-get&nbsp;source</tt>, <em>not</em> when downloading the <tt>linux-source</tt> package from <tt>kernel.org</tt></strong> <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span></p><p class="line874">Use this command to build all targets for the architecture you are building on: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span></p><p class="line867"><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></p><pre><span class="anchor" id="line-1-10"></span>fakeroot debian/rules clean
<span class="anchor" id="line-2-5"></span>AUTOBUILD=1 fakeroot debian/rules binary-debs</pre><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><p class="line867"><tt>debian/rules&nbsp;clean</tt> creates <tt>debian/control</tt>, <tt>debian/changelog</tt>, and so on from <tt>debian.&lt;branchname&gt;/*</tt> (e.g. <tt>debian.master</tt>).
 It is necessary in git trees following git commit 
3ebd3729ce35b784056239131408b9a72b0288ef "UBUNTU: [Config] Abstract the 
debian directory". <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span></p><p class="line862">The <tt>AUTOBUILD</tt>
 environment variable triggers special features in the kernel build. 
First, it skips normal ABI checks (ABI is the binary compatibility). It 
can do this because it also creates a unique ABI ID. If you used a git 
repo, this unique ID is generated from the git HEAD SHA. If not, it is 
generated from the <tt>uuidgen</tt> program (which means every time you execute the <tt>debian/rules</tt>
 build, the UUID will be different!). Your packages will be named using 
this ID. (Note that in Intrepid and newer, you will need <tt>skipabi=true</tt> to skip ABI checks.) <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span></p><p class="line874">To build a specific target, use this command: <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></p><p class="line867"><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span></p><pre><span class="anchor" id="line-1-11"></span>fakeroot debian/rules clean
<span class="anchor" id="line-2-6"></span>AUTOBUILD=1 NOEXTRAS=1 fakeroot debian/rules binary-FLAVOUR</pre><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line862">Where <tt>FLAVOUR</tt> is one of the main flavours of the kernel (e.g. <tt>generic</tt>) <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span></p><p class="line862">To build one of the custom flavours (found in <tt>debian/binary-custom.d/</tt>), use: <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></p><p class="line867"><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span></p><pre><span class="anchor" id="line-1-12"></span>fakeroot debian/rules clean
<span class="anchor" id="line-2-7"></span>AUTOBUILD=1 NOEXTRAS=1 fakeroot debian/rules custom-binary-FLAVOUR</pre><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><p class="line862">As of this documentation, custom flavours include <tt>xen</tt> and <tt>rt</tt>. <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span></p><p class="line862">If
 you have a more than one processor or more than one core, you can speed
 things up by running concurrent compile commands. Prepend <tt>CONCURRENCY_LEVEL=2</tt>
 for two processors or two cores; replace '2' with whatever number suits
 your hardware setup (for Gutsy and later, you can alternatively use <tt>DEB_BUILD_OPTIONS=parallel=2</tt>). <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></p><p class="line867"><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span></p><pre><span class="anchor" id="line-1-13"></span>fakeroot debian/rules clean
<span class="anchor" id="line-2-8"></span>DEB_BUILD_OPTIONS=parallel=2 AUTOBUILD=1 NOEXTRAS=1 fakeroot debian/rules binary-generic</pre><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line862">If you get ABI errors, you can avoid the ABI check with <tt>skipabi=true</tt>. For example, <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p><p class="line867"><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span></p><pre><span class="anchor" id="line-1-14"></span>fakeroot debian/rules clean
<span class="anchor" id="line-2-9"></span>DEB_BUILD_OPTIONS=parallel=2 AUTOBUILD=1 NOEXTRAS=1 skipabi=true fakeroot debian/rules binary-generic</pre><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line862">To trigger a rebuild, remove the appropriate stamp file from <tt>debian/stamps</tt> (e.g. <tt>stamp-build-server</tt> for the <tt>server</tt> flavour, etc.). <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span></p><p class="line874">The debs are placed in your kernel directory's parent directory. <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span></p><p class="line874">If needed, the Ubuntu modules source for Hardy (8.04) can be built in a similar way. <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span></p><pre><span class="anchor" id="line-1-15"></span>cd linux-ubuntu-modules-2.6.24-2.6.24
<span class="anchor" id="line-2-10"></span>AUTOBUILD=1 fakeroot debian/rules binary-debs</pre><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line874">Alternatively, if you need to specify a different kernel than the running one, use <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span></p><pre><span class="anchor" id="line-1-16"></span>cd linux-ubuntu-modules-2.6.24-2.6.24
<span class="anchor" id="line-2-11"></span>AUTOBUILD=1 fakeroot debian/rules binary-debs KDIR=/path/to/kerneldir</pre><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><p class="line862">If you get an error, try running this in the <tt>kerneldir</tt>: (example for the <tt>generic</tt> flavour) <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span></p><pre><span class="anchor" id="line-1-17"></span>cat debian/config/i386/config debian/config/i386/config.generic &gt; .config
<span class="anchor" id="line-2-12"></span>make prepare scripts</pre><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line867"><span class="anchor" id="AltBuildMethod"></span> <span class="anchor" id="line-217"></span>
</p><h2 id="Alternate_Build_Method:_The_Old-Fashioned_Debian_Way">Alternate Build Method: The Old-Fashioned Debian Way</h2>
<span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line862">The
 new Ubuntu build system is great for developers, for people who need 
the absolute latest bleeding-edge kernel, and people who need to build a
 diverse set of kernels (several "flavours"). However it can be a little
 complex for ordinary users. If you don't need the latest development 
sources, there is a simpler way to compile your kernel from the <tt>linux-source</tt> package. As suggested above, all you need for this is: <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><pre><span class="anchor" id="line-1-18"></span>sudo apt-get install linux-source device-tree-compiler # device-tree-compiler is only needed if you are targeting the PowerPC architecture
<span class="anchor" id="line-2-13"></span>mkdir ~/src
<span class="anchor" id="line-3-2"></span>cd ~/src
<span class="anchor" id="line-4-1"></span>tar xjvf /usr/src/linux-source-&lt;version-number-here&gt;.tar.bz2
<span class="anchor" id="line-5-1"></span>cd linux-source-&lt;version-number-here&gt;</pre><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line874">Now
 you are in the top directory of a kernel source tree. Before building 
the kernel, you must configure it. If you wish to re-use the 
configuration of your currently-running kernel, start with <span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span></p><pre><span class="anchor" id="line-1-19"></span>cp -vi /boot/config-`uname -r` .config</pre><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line862">Before you run <tt>make&nbsp;menuconfig</tt> or <tt>make&nbsp;xconfig</tt> (which is what the next step tells you to do), make sure you have the necessary packages: <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span></p><p class="line867"><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span></p><pre><span class="anchor" id="line-1-20"></span>sudo apt-get install qt3-dev-tools libqt3-mt-dev # if you plan to use 'make xconfig'
<span class="anchor" id="line-2-14"></span>sudo apt-get install libncurses5 libncurses5-dev # if you plan to use 'make menuconfig'</pre><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><p class="line874">If
 you would like to see what is different between your original kernel 
config and the new one (and decide whether you want any of the new 
features), you can run: <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span></p><pre><span class="anchor" id="line-1-21"></span>make oldconfig</pre><span class="anchor" id="line-244"></span><p class="line874">Since
 the 2.6.32 kernel, a new feature allows you to update the configuration
 to only compile modules that are actually used in your system: <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span></p><pre><span class="anchor" id="line-1-22"></span>make localmodconfig</pre><span class="anchor" id="line-248"></span><p class="line874">Then, regardless of whether you're re-using an existing configuration or starting from scratch: <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span></p><pre><span class="anchor" id="line-1-23"></span>make menuconfig # or "make xconfig" if you prefer</pre><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><p class="line862">If
 you re-used the existing configuration, note that Ubuntu kernels build 
with debugging information on, which makes the resulting kernel modules 
(*.ko files) much larger than they would otherwise be. To turn this off,
 go into the config's "Kernel hacking"&lt;!-- ; then, under "Kernel 
debugging", --&gt; and turn OFF "Compile the kernel with debug info". <span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span></p><p class="line874">Now you can compile the kernel and create the packages: <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span></p><pre><span class="anchor" id="line-1-24"></span>make clean # only needed if you want to do a "clean" build
<span class="anchor" id="line-2-15"></span>make deb-pkg</pre><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><p class="line862">You can enable parallel make use <tt>make&nbsp;-j</tt>). Try 1+<em>number of processor cores</em>, e.g. 3 if you have a dual core processor: <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span></p><pre><span class="anchor" id="line-1-25"></span>make -j3 deb-pkg</pre><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line862">The
 *.deb packages will be created in the parent directory of your Linux 
source directory (in this example, they would be placed in <tt>~/src</tt> because our Linux source directory is <tt>~/src/linux-source-&lt;version-number-here&gt;</tt>). <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span></p><p class="line867">
</p><h2 id="Install_the_new_kernel">Install the new kernel</h2>
<span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line862">If
 you want to see the Ubuntu splash screen (or use text mode) before you 
get to X instead of just a black screen, you'll want to make sure the <tt>framebuffer</tt> driver loads: <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span></p><pre><span class="anchor" id="line-1-26"></span>echo vesafb | sudo tee -a /etc/initramfs-tools/modules
<span class="anchor" id="line-2-16"></span>echo fbcon | sudo tee -a /etc/initramfs-tools/modules</pre><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><p class="line862">Now that you've told <tt>initramfs-tools</tt> which modules it should include, and once the build is complete, you can install the generated debs using <tt>dpkg</tt>: <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span></p><p class="line867"><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span></p><pre><span class="anchor" id="line-1-27"></span>sudo dpkg -i linux-image-2.6.20-16-2be-k7_2.6.20-16_i386.deb
<span class="anchor" id="line-2-17"></span>sudo dpkg -i linux-headers-2.6.20-16-2be-k7_2.6.20-16_i386.deb</pre><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><p class="line874">Similarly, if you have built the Ubuntu module for Hardy (8.04) earlier, install them as follows: <span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span></p><p class="line867"><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span></p><pre><span class="anchor" id="line-1-28"></span>sudo dpkg -i linux-ubuntu-modules-2.6.24-16-generic_2.6.24-16.23_i386.deb
<span class="anchor" id="line-2-18"></span>sudo dpkg -i linux-headers-lum-2.6.24-16-generic_2.6.24-16.23_i386.deb</pre><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><p class="line862">If you use modules from <tt>linux-restricted-modules</tt>, you will need to recompile this against your new <tt>linux-headers</tt> package. <span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span></p><p class="line874">Note:
 In response to the various comments in the remainder of this section: 
On Ubuntu Precise (12.04) it appears that postinst DOES take care of the
 initramfs stuff. After installing the package my new kernel booted just
 fine without following any of the methods below. Someone please correct
 me if I'm mistaken. <span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span></p><p class="line862">Since Ubuntu Lucid (10.04) the image postinst no longer runs the <tt>initramfs</tt>
 creation commands. Instead, there are example scripts provided that 
will perform the task. These scripts will work for official kernel 
images as well. For example: <span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span></p><pre><span class="anchor" id="line-1-29"></span>sudo cp /usr/share/doc/kernel-package/examples/etc/kernel/postinst.d/initramfs /etc/kernel/postinst.d/initramfs
<span class="anchor" id="line-2-19"></span>sudo mkdir -p /etc/kernel/postrm.d/
<span class="anchor" id="line-3-3"></span>sudo cp /usr/share/doc/kernel-package/examples/etc/kernel/postrm.d/initramfs /etc/kernel/postrm.d/initramfs</pre><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line867"><em>Note: I couldn't get the above scripts to help in generating an <tt>initrd</tt> for the kernel - and so the built kernel couldn't boot; the only thing that worked for me was the recommendation in <a class="http" href="http://www.debian-administration.org/article/How_Do_I_Make_an_initrd_image">http://www.debian-administration.org/article/How_Do_I_Make_an_initrd_image</a>, "use initramfs command. It is real solution."; what I used (after the custom-built kernel's *.deb's were installed), was: <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span></em></p><pre><em><span class="anchor" id="line-1-30"></span>cd /boot
<span class="anchor" id="line-2-20"></span>sudo mkinitramfs -k -o initrd.img-2.6.32.15+drm33.5-mylucid 2.6.32.15+drm33.5-mylucid
<span class="anchor" id="line-3-4"></span>sudo update-grub2</em></pre><em><span class="anchor" id="line-307"></span></em><p class="line867"><em></em> <span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span></p><p class="line867"><em>Note (Michael): that is because you need to include the right package scripts to build the <tt>initrd</tt> at package install time. The <tt>make-kpkg</tt> option is <tt>--overlay-dir</tt>. By default, <tt>make-kpkg</tt> uses <tt>/usr/share/kernel-package</tt>
 as an overlay directory, which contains the default, uncustomised 
scripts for a Debian distribution, and not the ones needed for building a
 Ubuntu kernel. <span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span></em></p><p class="line862"><em>The following instructions are based on this link: <a class="http" href="http://crashcourse.ca/introduction-linux-kernel-programming/intermission-building-new-ubuntu-1004-kernel-free-lesson">http://crashcourse.ca/introduction-linux-kernel-programming/intermission-building-new-ubuntu-1004-kernel-free-lesson</a> <span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span></em></p><p class="line874"><em>First copy the default overlay directory to your home directory: <span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span></em></p><pre><em><span class="anchor" id="line-1-31"></span>$ cp -r /usr/share/kernel-package $HOME</em></pre><em><span class="anchor" id="line-317"></span><p class="line874">Then install the source of the kernel you are using currently, using the exact package name, e.g. <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span></p><pre><span class="anchor" id="line-1-32"></span>$ cd
<span class="anchor" id="line-2-21"></span>$ apt-get source linux-image-2.6.32-24-generic</pre><span class="anchor" id="line-322"></span><p class="line874">which will unpack the sources to $HOME/linux-2.6.32. Now copy the control scripts into your new overlay: <span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span></p><pre><span class="anchor" id="line-1-33"></span>$ cp linux-2.6.32/debian/control-scripts/{postinst,postrm,preinst,prerm} kernel-package/pkg/image/
<span class="anchor" id="line-2-22"></span>$ cp linux-2.6.32/debian/control-scripts/headers-postinst kernel-package/pkg/headers/</pre><span class="anchor" id="line-327"></span></em><p class="line862"><em>And now you can execute <tt>make-kpkg</tt> with the additional command line option <tt>--overlay-dir=$HOME/kernel-package</tt>. <span class="anchor" id="line-328"></span></em> <span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span></p><p class="line867">
</p><h2 id="Rebuilding_.27.27linux-restricted-modules.27.27">Rebuilding ''linux-restricted-modules''</h2>
<span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><p class="line874">The
 linux-restricted-modules (l-r-m) package contains a number of 
non-DFSG-free drivers (as well as some firmware and the ipw3945 wireless
 networking daemon) which, in a perfect world, wouldn't have to be 
packaged separately, but which unfortunately are not available under a 
GPL-compatible license. If you use any of the hardware supported by the 
l-r-m package, you will likely find that your system does not work as 
well after switching to a custom kernel. In this case you should try to 
compile the l-r-m package. <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span></p><p class="line862">See <a href="https://help.ubuntu.com/community/CustomRestrictedModules">CustomRestrictedModules</a> on how to rebuild l-r-m (if you use nVidia or ATI binary drivers, you do). <span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span></p><p class="line874">Note:
 you will need around 8 hours of compilation time and around 10 Gb of 
hard drive space to compile all kernel flavours and restricted modules. <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span></p><p class="line874">Further note: There are no l-r-m or linux-restricted-modules packages in Lucid. <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span></p><p class="line867">
</p><h2 id="Speeding_Up_the_Build">Speeding Up the Build</h2>
<span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><p class="line862">Use <tt>distcc</tt> and, if you're rebuilding often, <tt>ccache</tt>. A good overview of using <tt>distcc</tt> on a debian-based system is available at <a class="http" href="http://myrddin.org/howto/using-distcc-with-debian">http://myrddin.org/howto/using-distcc-with-debian</a>. If you have AMD64 machines available on your local net, they can still participate in building 32-bit code; <tt>distcc</tt> seems to handle that automatically. However, with <tt>distcc</tt> taking over all compiles by default, you will need to set <tt>HOSTCC</tt>
 so that when kernel builds want to use the compiler on the host itself,
 they don't end up distributing jobs to the 64-bit server. If you fail 
to do that, you'll get link-compatibility failures between 64-bit and 
32-bit code. My <tt>make-kpkg</tt> command, with <tt>/usr/lib/ccache</tt> at the head of my <tt>$PATH</tt>, looks like: <span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span></p><p class="line867"><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span></p><pre><span class="anchor" id="line-1-34"></span>MAKEFLAGS="HOSTCC=/usr/bin/gcc CCACHE_PREFIX=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source</pre><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><p class="line867">
</p><h2 id="More_documentation">More documentation</h2>
<span class="anchor" id="line-349"></span><ul><li><p class="line891"><a class="https" href="https://help.ubuntu.com/community/forum/software/CustomKernel">https://help.ubuntu.com/community/forum/software/CustomKernel</a> <span class="anchor" id="line-350"></span></p></li><li><p class="line891"><a href="https://help.ubuntu.com/community/UpgradeKernel">UpgradeKernel</a> , with easier ways. <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span></p></li></ul><p class="line867">
</p><h2 id="Comments">Comments</h2>
<span class="anchor" id="line-353"></span><p class="line862">Please go to the community wiki page for comments, questions and discussion: <a class="https" href="https://wiki.ubuntu.com/KernelCustomBuild">https://wiki.ubuntu.com/KernelCustomBuild</a> <span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span></p><p class="line867">
</p><h2 id="External_information">External information</h2>
<span class="anchor" id="line-356"></span><ul><li><p class="line891"><a class="http" href="http://www.howtoforge.com/kernel_compilation_ubuntu">http://www.howtoforge.com/kernel_compilation_ubuntu</a> Compile a kernel from kernel.org source in Ubuntu <span class="anchor" id="line-357"></span></p></li><li><p class="line891"><a class="http" href="http://kernel-handbook.alioth.debian.org/ch-common-tasks.html#s-common-building">http://kernel-handbook.alioth.debian.org/ch-common-tasks.html#s-common-building</a> <span class="anchor" id="line-358"></span></p></li></ul><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-359"></span><a href="https://help.ubuntu.com/community/CategoryKernel">CategoryKernel</a> <span class="anchor" id="line-360"></span><span class="anchor" id="bottom"></span></p></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" dir="ltr" lang="en">Kernel/Compile  (last edited 2013-03-05 14:08:04 by <span title="timo-jyrinki @ dsl-hkibrasgw3-58c0fc-85.dhcp.inet.fi[88.192.252.85]"><a class="interwiki" href="https://launchpad.net/%7Etimo-jyrinki" title="timo-jyrinki @ dsl-hkibrasgw3-58c0fc-85.dhcp.inet.fi[88.192.252.85]">timo-jyrinki</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details<br><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div>


</body></html>