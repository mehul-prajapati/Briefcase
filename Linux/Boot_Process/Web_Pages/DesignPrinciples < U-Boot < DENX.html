<!--
	 Following are default twiki template definitions
-->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!--

	Below are DenxSkin specific templates

-->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!-- =========================================================================== -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us"><head>
 <title>  DesignPrinciples &lt; U-Boot &lt; DENX</title>
 <meta http-equiv="Content-Type" content="text/html; charset=windows-1252"> <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://www.denx.de/wiki/view/U-Boot/WebRss?skin=rss&amp;contenttype=text/xml">
 <!-- base href="http://www.denx.de/wiki/view/U-Boot/DesignPrinciples" -->
 <link rel="stylesheet" type="text/css" href="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/denx-screen.css" media="screen" title="DenxSkin (screen)">
<link rel="stylesheet" type="text/css" href="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/denx-print.css" media="print">
<style type="text/css">
.translationLink:lang(de):before { content: url(/static/layout/denx/germany.png)" " }
.translationLink:lang(en):before { content: url(/static/layout/denx/united_kingdom.png)" "}
.emailLink:before { content: url(/static/layout/denx/mail.gif)" " }
</style>

 
</head>
<body>
    <!-- For non-visual user agents: -->
      <div id="top"><a href="#main-copy" class="doNotDisplay doNotPrint">Skip to main content.</a></div>
<a name="PageTop"></a>
<!--
  TODO:  
-->
    <div id="header">
      <div class="superHeader">
        <div class="left">
     <span class="doNotDisplay">Navigation:</span>
<a class="twikiLink" href="http://www.denx.de/wiki/Main/WebHome">DENX</a>
&gt; <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebHome">U-Boot</a>
&gt; <span class="highlight"><a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/DesignPrinciples">DesignPrinciples</a></span>   
        </div>
        <div class="right">
            <span class="doNotDisplay">Translations:</span> 
  <a href="http://www.denx.de/wiki/edit/U-Boot/DesignPrinciples?t=1395152281"><b>Edit</b></a>
   |  <a href="http://www.denx.de/wiki/attach/U-Boot/DesignPrinciples">Attach</a>
   |  <a href="http://www.denx.de/wiki/view/U-Boot/DesignPrinciples?raw=on">Raw</a>
   |  <a href="http://www.denx.de/wiki/search/U-Boot/SearchResult?scope=text&amp;regex=on&amp;excludetopic=DesignPrinciples&amp;search=Design%20*Principles%5B%5EA-Za-z0-9%5D">Ref-By</a>
   |  <a href="http://www.denx.de/wiki/view/U-Boot/DesignPrinciples?skin=print">Printable</a>
   |  <a href="http://www.denx.de/wiki/oops/U-Boot/DesignPrinciples?template=oopsmore&amp;param1=1.15&amp;param2=1.15">More</a> 
        </div>
      </div>
      <div class="midHeader">
        <img class="logoImage" alt="Denx.de" src="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/denx-full-header.gif">
        <h1>U-Boot</h1>
      </div>
      <div class="subHeader">
   <span class="doNotDisplay">Sections of this site:</span> <a href="http://www.denx.de/en/News/WebHome" target="_top">DENX Home</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/DULG/WebHome">DULG</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/ELDK-5/WebHome">ELDK-5</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/Know/WebHome">Know</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/Training2/WebHome">Training</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebHome">U-Boot</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/U-Bootdoc/WebHome">U-Bootdoc</a>  |  <a class="twikiLink" href="http://www.denx.de/wiki/Rtlug-muc/WebHome">Rtlug-muc</a>
      </div>
    </div>
          <div id="side-bar">
      <div id="side-nav">
        <p>
    <a href="http://endsoftpatents.org/innovating-without-patents">
  <img style="border-width:0" src="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/esp_chicklet.png">
    </a></p>
        <p class="sideBarTitle">Topics</p>
        <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebHome">U-Boot Home</a> <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/Documentation">Documentation</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/SourceCode">Source Code</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/Custodians">The Custodians</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/CustodianGitTrees">Custodian Repositories</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/DevelopmentProcess">Development Process</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/ReleaseCycle">Release Cycle</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/CodingStyle">Coding Style</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/Patches">Patches</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/Tasks">Tasks</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/Contacts">Contacts</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebChanges">Changes</a>  <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebIndex">Index</a>
   <form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input name="cmd" value="_s-xclick" type="hidden"><input name="hosted_button_id" value="4456157" type="hidden"><input src="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" type="image" border="0"><img alt="" src="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/pixel.gif" width="1" height="1" border="0"></form>
      </div><div>
        <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebTopicList">List of pages in U-Boot</a>
        <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/WebSearch">Search</a>
      </div>
<!-- buggy      &gt;div&amp;
        <font size="-1" class="twikiAlert" color="#FF0000">TOC: No TOC in "U-Boot.DesignPrinciples"</font>
        %CONTENTS{topic="DesignPrinciples" depth=3}%
      </div> -->
     <div style="text-align:center">
  <img src="DesignPrinciples%20%3C%20U-Boot%20%3C%20DENX_files/linux-logo.gif" alt="">
</div>
    </div>
  <hr class="doNotDisplay">
<p>
  </p><div id="main-copy"><h1><a name="U_Boot_Design_Principles"> </a><a name="_U_Boot_Design_Principles"> </a>  U-Boot Design Principles </h1>
<p>
</p><h1><a name="The_10_Golden_Rules_of_U_Boot_de"> </a> The 10 Golden Rules of U-Boot design: </h1>
<p>
</p><div class="twikiToc">
<ul>
<li> <a href="#The_10_Golden_Rules_of_U_Boot_de">The 10 Golden Rules of U-Boot design:</a>
<ul>
<li> <a href="#1_Keep_it_Small">1. Keep it Small</a>
</li>
<li> <a href="#2_Keep_it_Fast">2. Keep it Fast</a>
</li>
<li> <a href="#3_Keep_it_Simple">3. Keep it Simple</a>
</li>
<li> <a href="#4_Keep_it_Portable">4. Keep it Portable</a>
</li>
<li> <a href="#5_Keep_it_Configurable">5. Keep it Configurable</a>
</li>
<li> <a href="#6_Keep_it_Debuggable">6. Keep it Debuggable</a>
</li>
<li> <a href="#7_Keep_it_Usable">7. Keep it Usable</a>
</li>
<li> <a href="#8_Keep_it_Maintainable">8. Keep it Maintainable</a>
</li>
<li> <a href="#9_Keep_it_Beautiful">9. Keep it Beautiful</a>
</li>
<li> <a href="#10_Keep_it_Open">10. Keep it Open</a>
</li>
</ul>
</li>
<li> <a href="#Lemmas_from_the_golden_rules">Lemmas from the golden rules</a>
<ul>
<li> <a href="#1_Generic_Code_is_Good_Code">1. Generic Code is Good Code</a>
</li>
</ul>
</li>
</ul>
</div>
<p>
<a name="KeepSmall"></a>
</p><h2><a name="1_Keep_it_Small"> </a> 1. Keep it Small </h2>
<p>
U-Boot is a Boot Loader, i.e. its primary purpose in the shipping
system is to load some operating system.
That means that U-Boot is
necessary to perform a certain task, but it's nothing you want to
throw any significant resources at. Typically U-Boot is stored in
relatively small NOR flash memory, which is expensive
compared to the much larger NAND devices often used to store the
operating system and the application.
</p><p>
At the moment, U-Boot supports boards with just 128 KiB ROM or with
256 KiB NOR flash. We should not easily ignore such configurations -
they may be the exception in among all the other supported boards,
but if a design uses such a resource-constrained hardware setup it is
usually because costs are critical, i. e. because the number of
manufactured boards might be tens or hundreds of thousands or even
millions...
</p><p>
A usable and useful configuration of U-Boot, including a basic
interactive command interpreter, support for download over Ethernet
and the capability to program the flash shall fit in no more than 128 KiB.
</p><p>
<a name="KeepFast"></a>
</p><h2><a name="2_Keep_it_Fast"> </a> 2. Keep it Fast </h2>
<p>
The end user is not interested in running U-Boot. In most embedded
systems he is not even aware that U-Boot exists. The user wants to
run some application code, and that as soon as possible after switching
on his device.
</p><p>
It is therefore essential that U-Boot is as fast as possible,
especially that it loads and boots the operating system as fast as possible.
</p><p>
To achieve this, the following design principles shall be followed:
</p><p>
</p><ul>
<li> Enable caches as soon and whenever possible
</li>
<li> Initialize devices only when they are needed within U-Boot,
     i.e. don't initialize the Ethernet interface(s) unless
     U-Boot performs a download over Ethernet;
     don't  initialize any IDE or USB devices unless U-Boot actually
     tries to load files from these, etc.
     (and don't forget to shut down these devices after using them  -
     otherwise nasty things may happen when you try to boot your OS).
</li>
</ul>
<p>
Also, building of U-Boot shall be as fast as possible.
This makes it easier to run a build for all supported configurations
or at least for all configurations of a specific architecture,
which is essential for quality assurance.
If building is cumbersome and slow, most people will omit
this important step.
</p><p>
<a name="KeepSimple"></a>
</p><h2><a name="3_Keep_it_Simple"> </a> 3. Keep it Simple </h2>
<p>
U-Boot is a boot loader, but it is also a tool used for board
bring-up, for production testing, and for other activities  
</p><p>
<a name="KeepPortable"></a>
</p><h2><a name="4_Keep_it_Portable"> </a> 4. Keep it Portable </h2>
<p>
U-Boot is a boot loader, but it is also a tool used for board
bring-up, for production testing, and for other activities that are
very closely related to hardware development. So far, it has been
ported to several hundreds of different boards on about 30 different
processor families - please make sure that any code you add can be
used on as many different platforms as possible.
</p><p>
Avoid assembly language whenever possible - only the reset code with 
basic CPU initialization, maybe a static DRAM initialization and the C 
stack setup should be in assembly.
All further initializations should be done in C using assembly/C 
subroutines or inline macros. These functions represent some
kind of HAL functionality and should be defined consistently on all
architectures. E.g. Basic MMU and cache control, stack pointer manipulation.
Non-existing functions should expand into empty macros or error codes.
</p><p>
Don't make assumptions over the environment where U-Boot is running.
It may be communicating with a human operator on directly attached
serial console, but it may be through a GSM modem as well, or driven
by some automatic test or control system. So don't output any fancy
control character sequences or similar.
</p><p>
<a name="KeepConfigurable"></a>
</p><h2><a name="5_Keep_it_Configurable"> </a> 5. Keep it Configurable </h2>
<p>
Section "Keep it Small" already explains about the size restrictions
for U-Boot on one side. On the other side, U-Boot is a powerful tool
with many, many extremely useful features. The maintainer or user of
each board will have to decide which features are important to him and
what shall be included with his specific board configuration to meet
his current requirements and restrictions.
</p><p>
Please make sure that it is easy to add or remove features from a
board configuration, so everybody can make the best use of U-Boot on
his system.
</p><p>
If a feature is not included, it should not have any residual code
bloating the build.
</p><p>
<a name="KeepDebuggable"></a>
</p><h2><a name="6_Keep_it_Debuggable"> </a> 6. Keep it Debuggable </h2>
<p>
Of course debuggable code is a big benefit for all of us contributing
in one way or another to the development of the U-Boot project. But
as already mentioned in section "Keep it Portable" above, U-Boot is
not only a tool in itself, it is often also used for hardware
bring-up, so debugging U-Boot often means that we don't know if we are
tracking down a problem in the U-Boot software or in the hardware we
are running on. Code that is clean and easy to understand and to
debug is all the more important to many of us.
</p><p>
</p><ul>
<li> One important feature of U-Boot is to enable output to the
     (usually serial) console as soon as possible in the boot process,
     even if this causes tradeoffs in other areas like memory footprint.
</li>
<li> All initialization steps shall print some "begin doing this"
     message before they actually start, and some "done" message when
     they complete. For example, RAM initialization and size detection
     may print a "RAM: " before they start, and "256 MB\n" when done.
     The purpose of this is that you can always see which initialization
     step was running if there should be any problem.
     This is important not only during software development,
     but also for the service people dealing with broken hardware in the field.
</li>
<li> U-Boot should be debuggable with simple JTAG or BDM equipment.
     It shall use a simple, single-threaded execution model.
     Avoid any magic, which could prevent easy debugging even
     when only 1 or 2 hardware breakpoints are available. 
</li>
</ul>
<p>
<a name="KeepUsable"></a>
</p><h2><a name="7_Keep_it_Usable"> </a> 7. Keep it Usable </h2>
<p>
Please always keep in mind that there are at least three different
groups of users for U-Boot, with completely different expectations
and requirements:
</p><ul>
<li> The end user of an embedded device just wants to run some
     application; he does not even want to know that U-Boot
     exists and only
     rarely interacts with it (for example to perform a reset to
     factory default settings etc.)
</li>
<li> System designers and engineers working on the development of the
     application and/or the operating system want a powerful tool that
     can boot from any boot device they can imagine, they want it fast
     and scriptable and whatever - in short, they want as many
     features supported as possible. And some more.
</li>
<li> The engineer who ports U-Boot to a new board and the board
     maintainer want U-Boot to be as simple as possible so porting it
     to and maintaining it on their hardware is easy for them.
</li>
<li> Make it easy to test. Add debug code (but don't re-invent the
     wheel - use existing macros like debug() or debugX()).
</li>
</ul>
<p>
Please always keep in mind that U-Boot tries to meet all these
different requirements.
</p><p>
<a name="KeepMaintainable"></a>
</p><h2><a name="8_Keep_it_Maintainable"> </a> 8. Keep it Maintainable </h2>
<p>
</p><ul>
<li> Avoid <code>#ifdefs</code> where possible
</li>
<li> Use "weak" functions
</li>
<li> Always follow the <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/CodingStyle">Coding Style</a> requirements.
</li>
</ul>
<p>
<a name="KeepBeautiful"></a>
</p><h2><a name="9_Keep_it_Beautiful"> </a> 9. Keep it Beautiful </h2>
<p>
</p><ul>
<li> Keep the source code clean: strictly follow the <a class="twikiLink" href="http://www.denx.de/wiki/U-Boot/CodingStyle">Coding Style</a>,
     keep lists (target names in the Makefiles, board names, etc.)
     alphabetically sorted, etc.
</li>
<li> Keep U-Boot console output clean: output only really necessary
     information, be terse but precise, keep output vertically
     aligned, do not use control character sequences (e.g. backspaces
     or \r to do "spinning wheel" activity indicators), etc.
</li>
</ul>
<p>
<a name="KeepOpen"></a>
</p><h2><a name="10_Keep_it_Open"> </a> 10. Keep it Open </h2>
<p>
Contribute your work back to the whole community. Submit your changes
and extensions as patches to the U-Boot mailing list.
</p><p>
</p><p>
</p><h1><a name="Lemmas_from_the_golden_rules"> </a> Lemmas from the golden rules </h1>
<p>
<a name="LemmaGeneric"></a>
</p><h2><a name="1_Generic_Code_is_Good_Code"> </a> 1. Generic Code is Good Code </h2>
<p>
New code shall be as generic as possible and added to the U-Boot
abstraction hierarchy as high as possible. As few code as possible shall be
added in board directories as people usually do not expect re-usable code
there.  Thus peripheral drivers should be put below
"drivers" even if they start out supporting only one specific
configuration.  Note that it is not a requirement for such a first
instance to be generic as genericity generally cannot be extrapolated
from a single data point. </p></div>
  <hr class="doNotDisplay">
<p>
</p><p>
    </p><div id="footer">
      <div class="left">
        <div class="TWikiFooterNote">
   Revision r1.15 - 30 Sep 2013 - 14:00 - <a class="twikiLink" href="http://www.denx.de/wiki/Main/MarioGoulart">MarioGoulart</a> 
 <br>
  <a href="http://www.denx.de/wiki/rdiff/U-Boot/DesignPrinciples">Diffs</a>  | r1.15 | <a href="http://www.denx.de/wiki/rdiff/U-Boot/DesignPrinciples?rev1=1.15&amp;rev2=1.14">&gt;</a> | <a href="http://www.denx.de/wiki/view/U-Boot/DesignPrinciples?rev=1.14">r1.14</a> | <a href="http://www.denx.de/wiki/rdiff/U-Boot/DesignPrinciples?rev1=1.14&amp;rev2=1.13">&gt;</a> | <a href="http://www.denx.de/wiki/view/U-Boot/DesignPrinciples?rev=1.13">r1.13</a>
 </div> 
      </div>
      <br class="doNotDisplay doNotPrint">
      <div class="right">
        <div class="TWikiCopyright">
Copyright © 2002-2014 by <strong>DENX</strong> Software Engineering
</div>
      </div>
    </div>
<a name="PageBottom"></a>

</body></html>