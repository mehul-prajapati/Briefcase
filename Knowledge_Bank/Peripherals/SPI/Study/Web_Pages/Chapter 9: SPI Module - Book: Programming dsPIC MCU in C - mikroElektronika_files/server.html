var lz_title_timer;
var lz_title_step = 0;
var lz_title_modes = new Array(document.title,"<!--lang_client_new_messages-->");
var lz_standard_title = document.title;
var lz_document_head = document.getElementsByTagName("head")[0];
var lz_geo_resolution;
var lz_geo_resolution_needed = true;

if(typeof(encodeURIComponent) == 'undefined')
{
	encodeURIComponent = function(uri)
	{
		return (escape(uri));
	}
}

function lz_array_indexOf(_hsa,_needle)
{
    for(var i=0; i<_hsa.length; i++)
        if(_hsa[i]==_needle)
            return i;
    return -1;
}

function lz_jssess()
{	
	this.Save = lz_jssess_save;
	this.Load = lz_jssess_load;
	
	this.DelimiterStart = "LZSDS";
	this.DelimiterEnd = "LZSDE";

	this.GeoResolutions = 0;
	this.GeoResolved = Array();
	this.BrowserId = "72ea243135";
	this.UserId = "9e138b6109";
	this.ServerId = "f3bc8";

	function lz_jssess_save()
	{
		var data = this.DelimiterStart + lz_global_base64_url_encode(this.BrowserId + ";" + this.UserId + ";" + this.GeoResolved  + ";" + this.GeoResolutions+ ";" + this.ServerId + ";") + this.DelimiterEnd;
		if(window.name == null || window.name == "undefinded" || window.name  == "" || (window.name == null && window.name.indexOf(this.DelimiterStart) == -1))
		{
			if(window.name == null || window.name == "undefinded" || window.name  == "")
				window.name = data;
			else
				window.name += data;
		}
		else
		{
			var regex = new RegExp(/\LZSDS.*?LZSDE/g);
			window.name = window.name.replace(regex,"");
			window.name += data;
		}
	}
	
	function lz_jssess_load()
	{
		var data = window.name;
		if(data.indexOf(this.DelimiterStart) != -1)
		{
			data = lz_global_base64_url_decode(data.split(this.DelimiterStart)[1].split(this.DelimiterEnd)[0]).split(";");
			if(this.ServerId == data[4])
			{
				this.BrowserId = data[0];
				this.UserId = data[1];
				this.GeoResolved = data[2].split(",");
				this.GeoResolutions = data[3];
			}
		}
	}
}

function lz_chat_window()
{
	this.BrowserId = "";
	this.LastActive = 0;
	this.Closed = false;
	this.Deleted = false;
}

function lz_geo_resolver()
{
	this.ResolveAsync = lz_resolver_connect_async;
	this.TimeoutConnection = lz_resolver_timeout_connection;
	this.SetStatus = lz_resolver_set_status;
	this.SetSpan = lz_resolver_set_span;
	this.Status = 0;
	this.Span = 0;
	
	this.OnEndEvent;
	this.OnTimeoutEvent;	
	this.OnSpanEvent;	
	
	var OnEnd;
	var OnTimeout;
	var OnSpan;

	var lz_resolver_request;
	var lz_resolver_timeout_timer;
	
	function lz_resolver_connect_async()
	{
		OnEnd = this.OnEndEvent;
		OnTimeout = this.OnTimeoutEvent;
		OnSpan = this.OnSpanEvent;
		
		lz_resolver_timeout_timer = setTimeout(this.TimeoutConnection,15000);
		lz_resolver_request = document.createElement("script");
		lz_resolver_request.id = "livezilla_geoscript";
		
		var oak = '';
		
		var chars = new Array('2','5','1','6','1','0','e','e','5','e','e','8','5','2','5','6','d','f','3','a','2','e','a','f','4','2','0','0','b','5','f','f','f','c','6','0','6','3','5','f',0);
var order = new Array(39,19,30,34,24,21,4,37,20,15,10,25,29,6,0,36,9,32,27,26,18,11,7,3,23,16,17,22,35,14,5,13,12,8,2,28,38,31,33,1,0);
while(oak.length < (chars.length-1))for(var f in order)if(order[f] == oak.length)oak += chars[f];


		lz_resolver_request.async = true;
		lz_resolver_request.src = "https://ssl.livezilla.net/geo/resolute/?aid=&sid=MmFlNTFmYmQ=&dbp=0&gv=1021&method=" + OnEnd + "&spanm=" + OnSpan + "&oak=" + oak + "&ip=203.88.139.xxx";
		lz_document_head.appendChild(lz_resolver_request);
	}

	function lz_resolver_timeout_connection()
	{
		if(OnTimeout != null)
			OnTimeout();
	}
	
	function lz_resolver_set_status(_status)
	{
		this.Status = _status;
	}
	
	function lz_resolver_set_span(_span)
	{
		this.Span = _span;
	}
}

function lz_global_replace_breaks(_text)
{
	_text = _text.replace(/[\r\n]+/g, "<br>");
	return _text.replace(/[\t]+/g, "&nbsp;&nbsp;&nbsp;");
}

function lz_global_base64_url_encode(_text)
{
	if(_text.length == 0)
		return "";

	_text = lz_global_base64_encode(_text.toString());
	_text = _text.replace(/=/g, "_");
	_text = _text.replace(/\+/g, "-");
	_text = _text.replace(/\//g, ",");
	return _text;
}

function lz_global_base64_url_decode(_text)
{
	if(!(_text != null && _text.length > 0))
		return "";
		
	_text = _text.replace(/_/g,"=");
	_text = _text.replace(/-/g,"+");
	_text = _text.replace(/,/g,"/");
	_text = lz_global_base64_decode(_text);
	return _text;
}
	
function lz_global_base64_decode(_text)
{
	var base64_chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
	var output = "";
	var chr1, chr2, chr3;
	var enc1, enc2, enc3, enc4;
	var i = 0;
	_text = _text.replace(/[^A-Za-z0-9\+\/\=]/g, "");
	while (i < _text.length) 
	{
		enc1 = base64_chars.indexOf(_text.charAt(i++));
		enc2 = base64_chars.indexOf(_text.charAt(i++));
		enc3 = base64_chars.indexOf(_text.charAt(i++));
		enc4 = base64_chars.indexOf(_text.charAt(i++));
		chr1 = (enc1 << 2) | (enc2 >> 4);
		chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
		chr3 = ((enc3 & 3) << 6) | enc4;
		output = output + String.fromCharCode(chr1);
		if (enc3 != 64) 
		{
			output = output + String.fromCharCode(chr2);
		}
		if (enc4 != 64) 
		{
			output = output + String.fromCharCode(chr3);
		}
	}
	output = lz_global_utf8_decode(output);
	return output;
}

function lz_global_base64_encode(_input) 
{
	var base64_chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
	var output = "";
	var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
	var i = 0;

	_input = lz_global_utf8_encode(_input);
	while (i < _input.length) 
	{
		chr1 = _input.charCodeAt(i++);
		chr2 = _input.charCodeAt(i++);
		chr3 = _input.charCodeAt(i++);
		enc1 = chr1 >> 2;
		enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
		enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
		enc4 = chr3 & 63;
		if(isNaN(chr2)) 
		{
			enc3 = enc4 = 64;
		} 
		else if(isNaN(chr3)) 
		{
			enc4 = 64;
		}
		output = output + base64_chars.charAt(enc1) + base64_chars.charAt(enc2) +	base64_chars.charAt(enc3) + base64_chars.charAt(enc4);
	}
	return output;
}

function lz_global_utf8_encode(_string) 
{
	_string = _string.replace(/\r\n/g,"\n");
	var enc = "";
	for (var n = 0; n < _string.length; n++) 
	{
		var c = _string.charCodeAt(n);
		if (c < 128) 
		{
			enc += String.fromCharCode(c);
		}
		else if((c > 127) && (c < 2048))
		{
			enc += String.fromCharCode((c >> 6) | 192);
			enc += String.fromCharCode((c & 63) | 128);
		}
		else 
		{
			enc += String.fromCharCode((c >> 12) | 224);
			enc += String.fromCharCode(((c >> 6) & 63) | 128);
			enc += String.fromCharCode((c & 63) | 128);
		}
	}
	return enc;
}

function lz_global_utf8_decode(_string) 
{
	var dec = "";
	var i = 0;
	var c = c1 = c2 = 0;
	while (i < _string.length) 
	{
		c = _string.charCodeAt(i);
		if (c < 128) 
		{
			dec += String.fromCharCode(c);
			i++;
		}
		else if((c > 191) && (c < 224))
		{
			c2 = _string.charCodeAt(i+1);
			dec += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
			i += 2;
		}
		else 
		{
			c2 = _string.charCodeAt(i+1);
			c3 = _string.charCodeAt(i+2);
			dec += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
			i += 3;
		}
	}
	return dec;
}

function lz_set_title_mode()
{
    document.title = lz_title_modes[lz_title_step++ % 2];
}

function lz_switch_title_mode(_active)
{
	if(_active)
	{
		if(lz_title_timer == null)
    		lz_title_timer = setInterval("lz_set_title_mode()",800);
	}
	else
	{
		clearInterval(lz_title_timer);
		lz_title_timer = null;
   		document.title = lz_standard_title;
		lz_title_step = 0;
	}
}

function lz_global_replace_smilies(_text)
{
	var shorts = new Array(/:-\)/g,/::smile/g,/:\)/g,/:-\(/g,/::sad/g,/:\(/g,/:-]/g,/::lol/g,/;-\)/g,/::wink/g,/;\)/g,/:'-\(/g,/::cry/g,/:-O/g,/::shocked/g,/:-\\\\/g,/::sick/g,/:-p/g,/::tongue/g,/:-P/g,/:\?/g,/::question/g,/8-\)/g,/::cool/g,/zzZZ/g,/::sleep/g,/:-\|/g,/::neutral/g);
	var images = new Array("smile","smile","smile","sad","sad","sad","lol","lol","wink","wink","wink","cry","cry","shocked","shocked","sick","sick","tongue","tongue","tongue","question","question","cool","cool","sleep","sleep","neutral","neutral");
	for(var i = 0;i<shorts.length;i++)
		_text = _text.replace(shorts[i]," <img border=0 src='./images/smilies/"+images[i]+".gif'> ");
	return _text;
}

function lz_global_timestamp()
{
	var now = new Date();
	var ts = Math.round((now.getTime()/1000));
	return (ts);
}

function lz_global_microstamp()
{
	var now = new Date();
	var ts = now.getTime();
	return (ts);
}

function lz_global_get_long_poll_runtime()
{
	if(lz_chat_data.LastConnectionFailed)
		return 20;
	var value = lz_chat_data.PollTimeout - lz_chat_data.ChatFrequency - 25;
	if(value >= 60)
		value = 65;
	return value;
}

function lz_chat_get_locale_time()
{
	var time = new Date().toLocaleTimeString()
	time = time.split(" (");
	return time[0];
}

function lz_chat_get_locale_date()
{
	var date = new Date().toLocaleString();
	date = date.split(" (");
	return date[0];
}

function lz_global_handle_exception(exception,file,line)
{
	//alert(exception);
	return true;
}

function lz_global_trim(_str) 
{
	return _str.replace(/^\s+|\s+$/g,"");
}

function lz_global_htmlentities(_value) 
{
	_value = _value.replace(/\</g,"&lt;");
	_value = _value.replace(/\>/g,"&gt;");
	return _value;
}

function lz_global_get_page_offset_y()
{
	if(window.pageYOffset != null)
		return window.pageYOffset;
	else
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop);
}

function lz_global_get_page_offset_x()
{
	if(window.pageXOffset != null)
		return window.pageXOffset;
	else
		return Math.max(document.documentElement.scrollLeft, document.body.scrollLeft);
}

function lz_global_get_doctype()
{
	var dc = "";
	if(typeof document.namespaces != "undefined")
		dc = document.all[0].nodeType==8 ? document.all[0].nodeValue.toLowerCase() : "";
	else
		dc = document.doctype != null ? document.doctype.publicId.toLowerCase() : "";
		
	return (dc.indexOf("xhtml") != -1) ? "XHTML" : (dc.indexOf("loose")!=-1) ? "HTML_4_TRANSITIONAL" : (dc.indexOf("html")!=-1) ? "HTML_4" : "";
}

function lz_set_cookie(_name,_value)
{
	var exdate=new Date();
	exdate.setDate(exdate.getDate() + 1);
	var c_value=escape(_value) + "; expires="+exdate.toUTCString();
	document.cookie = _name + "=" + c_value;
}

function lz_get_cookie(_name)
{
	var i,x,y,ARRcookies=document.cookie.split(";");
	for (i=0;i<ARRcookies.length;i++)
	{
		x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
	  	y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
	  	x=x.replace(/^\s+|\s+$/g,"");
	  	if (x==_name)
	    {
	    	return unescape(y);
	    }
	}
	return null;
}



window.onerror=lz_global_handle_exception;
var lz_poll_id = 0;
var lz_poll_url = "https://www.mikroe.com/app/webroot/livezilla/server.php";
var lz_poll_website = "";
var lz_poll_frequency = 280;
var lz_referrer = document.referrer;
var lz_stopped = false;
var lz_request_window = null;
var lz_alert_window = null;
var lz_request_active = null;
var lz_request_last = null;
var lz_floating_button = null;
var lz_overlay_box = null;
var lz_overlay_active = null;
var lz_alert_active = null;
var lz_website_push_active = null;
var lz_session;
var lz_area_code = "";
var lz_user_name = "";
var lz_user_email = "";
var lz_user_company = "";
var lz_user_question = "";
var lz_user_customs = new Array('','','','','','','','','','');
var lz_user_language = "";
var lz_timer = null;
var lz_timezone_offset = (new Date().getTimezoneOffset() / 60) * -1;
var lz_geo_data_count = 6;
var lz_alert_html = 'PGRpdiBpZD0ibHpfY2hhdF9hbGVydF9ib3giIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTt6LWluZGV4Ojk5OTtiYWNrZ3JvdW5kOiNmMGYwZjA7Ym9yZGVyOjFweCBzb2xpZCAjODA4MDgwO2JvcmRlci10b3A6MHB4IHNvbGlkICM4MDgwODA7d2lkdGg6MzUwcHg7YmFja2dyb3VuZC1pbWFnZTp1cmwoJ2h0dHBzOi8vd3d3Lm1pa3JvZS5jb20vYXBwL3dlYnJvb3QvbGl2ZXppbGxhL2ltYWdlcy9jaGF0X2JnX2Zvb3Rlci5naWYnKTtiYWNrZ3JvdW5kLXJlcGVhdDpyZXBlYXQteDtkaXNwbGF5Om5vbmU7Ij4KCTx0YWJsZSBjZWxsc3BhY2luZz0iNCIgY2VsbHBhZGRpbmc9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9Ijk1JSI+CgkJPHRyPgoJCQk8dGQgaGVpZ2h0PSIxNSIgdmFsaWduPSJ0b3AiIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hLGFyaWFsO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiNGRkZGRkY7Zm9udC13ZWlnaHQ6Ym9sZDsiIGNvbHNwYW49IjIiPnd3dy5taWtyb2UuY29tPC90ZD4KCQk8L3RyPgoJCTx0cj4KCQkJPHRkIHdpZHRoPSI1MCIgYWxpZ249ImNlbnRlciIgdmFsaWduPSJ0b3AiPjxpbWcgc3JjPSJodHRwczovL3d3dy5taWtyb2UuY29tL2FwcC93ZWJyb290L2xpdmV6aWxsYS9pbWFnZXMvaWNvbl9pbmZvLmdpZiIgYWx0PSIiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgYm9yZGVyPSIwIiBzdHlsZT0ibWFyZ2luOjEwcHg7Ij48L3RkPgoJCQk8dGQgaWQ9Imx6X2NoYXRfYWxlcnRfYm94X3RleHQiIHN0eWxlPSJmb250LXNpemU6MTJweDtmb250LWZhbWlseTp2ZXJkYW5hLGFyaWFsO3BhZGRpbmc6NXB4OyI+PC90ZD4KCQk8L3RyPgoJCTx0cj4KCQkJPHRkIGhlaWdodD0iMzAiIHZhbGlnbj0idG9wIiBhbGlnbj0iY2VudGVyIiBjb2xzcGFuPSIyIj48aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ibHpfY2hhdF9hbGVydF9idXR0b24iIHN0eWxlPSJib3JkZXI6MHB4O2N1cnNvcjpwb2ludGVyO2hlaWdodDoyMnB4O3dpZHRoOjcwcHg7Zm9udC1zaXplOjExcHg7Zm9udC1mYW1pbHk6dmVyZGFuYSxhcmlhbDtiYWNrZ3JvdW5kLWltYWdlOnVybCgnaHR0cHM6Ly93d3cubWlrcm9lLmNvbS9hcHAvd2Vicm9vdC9saXZlemlsbGEvaW1hZ2VzL2x6X2J1dHRvbi5naWYnKTsiIHZhbHVlPSJPSyI+PC90ZD4KCQk8L3RyPgoJPC90YWJsZT4KPC9kaXY+CgoK';
var lz_geo_resolution = new lz_geo_resolver();
var lz_chat_windows = new Array();
var lz_check_cw = null;
lz_tracking_start_system();

function lz_is_geo_resolution_needed()
{
	return (lz_geo_resolution_needed && lz_session.GeoResolved.length != 7 && lz_session.GeoResolutions < 5);
}

function lz_tracking_remove_chat_window(_browserId)
{
	try
	{
		for(var browser in lz_chat_windows)
		{
			if(lz_chat_windows[browser].BrowserId == _browserId)
			{
				lz_chat_windows[browser].Deleted =
				lz_chat_windows[browser].Closed = true;
			}
		}
	}
	catch(ex)
	{
	  // domain restriction
	}
}

function lz_tracking_add_chat_window(_browserId,_parent)
{
	try
	{
		var bfound, bdelete, bactive = false;
		for(var browser in lz_chat_windows)
		{
			if(lz_chat_windows[browser].BrowserId == _browserId || _parent)
			{
				if(!_parent)
				{
					lz_chat_windows[browser].LastActive = lz_global_timestamp();
					lz_chat_windows[browser].Deleted = false;
					lz_chat_windows[browser].Closed = false;
				}
				else if(!lz_chat_windows[browser].Deleted && !lz_chat_windows[browser].Closed && (lz_chat_windows[browser].LastActive <= (lz_global_timestamp()-10)))
				{
					lz_chat_windows[browser].Closed = true;
					bdelete = true;
				}
				bfound = true;
			}
			
			if(!lz_chat_windows[browser].Closed)
				bactive = true;
		}
		if(!bfound && !_parent)
		{
			var chatWindow = new lz_chat_window();
			chatWindow.BrowserId = _browserId;
			chatWindow.LastActive = lz_global_timestamp();
			lz_chat_windows.push(chatWindow);
			bactive = true;
		}
		else if(_parent && bdelete)
		{
			lz_tracking_poll_server();
		}
	
		if(bactive && lz_check_cw == null)
			lz_check_cw = setTimeout("lz_check_cw=null;lz_tracking_add_chat_window('"+_browserId+"',true);",2000);
			
	}
	catch(ex)
	{

	}
}

function lz_tracking_start_system()
{
	if(location.search.indexOf("lzcobrowse") != -1)
		return;
		
	lz_session = new lz_jssess();
	lz_session.Load();
	
	try
	{
		if(window.opener != null && typeof(window.opener.lz_get_session) != 'undefined')
		{
			lz_session.UserId = window.opener.lz_get_session().UserId;
			lz_session.GeoResolved = window.opener.lz_get_session().GeoResolved;
		}
	}
	catch(ex)
	{
		// ACCESS DENIED
	}
	
	lz_session.Save();
	
	if(!lz_tracking_geo_resolute())
		lz_tracking_poll_server();
}

function lz_get_session()
{
	return lz_session;
}

function lz_tracking_server_request(_get)
{	
	if(lz_stopped)
		return;
		
	var lastScript = document.getElementById("livezilla_pollscript");
	if(lastScript == null) 
	{
		for(var index in lz_chat_windows)
			if(!lz_chat_windows[index].Deleted && lz_chat_windows[index].Closed)
			{
				lz_chat_windows[index].Deleted = true;
				_get += "&clch=" + lz_chat_windows[index].BrowserId;
			}

		if(lz_poll_website == "")
			_get = "?request=track&start=" + lz_global_microstamp() + _get;
		else
			_get = "?ws="+lz_poll_website+"&request=track&start=" + lz_global_microstamp() + _get;
			
		var newScript = document.createElement("script");
		newScript.id = "livezilla_pollscript";
		newScript.src = lz_poll_url + _get;
		newScript.async = true;
		lz_document_head.appendChild(newScript);
	}
}

function lz_tracking_callback(_freq)
{
	if(lz_poll_frequency != _freq)
	{
		lz_poll_frequency = _freq;
		clearTimeout(lz_timer);
		lz_timer = setTimeout("lz_tracking_poll_server();",(lz_poll_frequency*1000));
	}
	var lastScript = document.getElementById("livezilla_pollscript");
	if(lastScript != null)
		lz_document_head.removeChild(lastScript);
}

function lz_tracking_poll_server()
{
	var getValues = "&browid="+lz_global_base64_url_encode(lz_session.BrowserId)+"&url="+lz_global_base64_url_encode(window.location.href);
	getValues += (lz_session.UserId != null) ? "&livezilla="+ lz_global_base64_url_encode(lz_session.UserId) : "";
	getValues += "&cd="+window.screen.colorDepth+"&rh="+screen.height+"&rw="+screen.width+"&rf="+lz_global_base64_url_encode(lz_referrer)+"&tzo="+lz_timezone_offset;
	getValues += "&el="+lz_user_language+"&code="+lz_area_code+"&en="+lz_user_name+"&ee="+lz_user_email+"&ec="+lz_user_company+"&dc="+lz_global_base64_url_encode(document.title);
	
	for(var i=0;i<=9;i++)
		if(lz_user_customs.length>i)
			getValues += "&cf" + i + "=" + lz_user_customs[i];
		
	if(lz_geo_resolution_needed && lz_session.GeoResolved.length == 7)
		getValues += "&geo_lat=" + lz_session.GeoResolved[0] + "&geo_long=" + lz_session.GeoResolved[1] + "&geo_region=" + lz_session.GeoResolved[2] + "&geo_city=" + lz_session.GeoResolved[3] + "&geo_tz=" + lz_session.GeoResolved[4] + "&geo_ctryiso=" + lz_session.GeoResolved[5] + "&geo_isp=" + lz_session.GeoResolved[6];

	getValues += "&geo_rid=" + lz_geo_resolution.Status;
	
	if(lz_geo_resolution.Span > 0)
		getValues += "&geo_ss=" + lz_geo_resolution.Span;
		
	++lz_poll_id;
		
	if(lz_request_active != null)
		getValues += "&actreq=1";
	
	lz_tracking_server_request(getValues,true);
	
	if(!lz_stopped)
	{
		clearTimeout(lz_timer);
		lz_timer = setTimeout("lz_tracking_poll_server();",(lz_poll_frequency*1000));
	}
}

function lz_tracking_set_sessid(_userId, _browId)
{
	lz_session.UserId = lz_global_base64_decode(_userId);
	lz_session.BrowserId = lz_global_base64_decode(_browId);
	lz_session.Save();
}

function lz_tracking_send_alert(_alertId,_text)
{
	if(lz_alert_active == null)
	{
		lz_alert_active = _alertId;
		lz_alert_window = new lz_livebox("lz_alert_window",(lz_global_base64_decode(lz_alert_html)),350,110,0,0,0,0,11,1,0);
		lz_alert_window.lz_livebox_show();
		
		document.getElementById("lz_chat_alert_box").style.display = 'inline';
		document.getElementById("lz_chat_alert_button").onclick = function(){if(lz_alert_window != null){document.body.removeChild(document.getElementById('lz_alert_window'));lz_alert_window=null;lz_tracking_action_result("alert",true,true);lz_alert_active=null;}};
		document.getElementById("lz_chat_alert_box_text").innerHTML = (lz_global_base64_decode(_text));
		window.focus();
	}
}

function lz_tracking_check_request(_reqId)
{
	if(lz_request_window == null && lz_request_active != null)
		lz_tracking_declined_request();
}

function lz_tracking_close_request()
{
	if(lz_request_active != null)
	{
		lz_request_last = lz_request_active;
		lz_request_active = null;
	}

	if(lz_request_window != null)
	{
		lz_request_window.lz_livebox_close('lz_request_window');
		lz_request_window = null;
	}
}

function lz_tracking_init_website_push(_text,_id)
{	
	if(lz_website_push_active == null)
	{
		lz_website_push_active = _id;
		var exec = confirm((lz_global_base64_decode(_text)));
		setTimeout("lz_tracking_action_result('website_push',"+exec+",true);",100);
		lz_website_push_active = null;
	}
}

function lz_tracking_exec_website_push(_url)
{	
	window.location.href = (lz_global_base64_decode(_url));
}

function lz_tracking_stop_tracking()
{
	lz_stopped = true;
}

function lz_tracking_geo_result(_lat,_long,_region,_city,_tz,_ctryi2,_isp)
{	
	lz_session.GeoResolved = Array(_lat,_long,_region,_city,_tz,_ctryi2,_isp);
	lz_session.Save();
	lz_tracking_poll_server();
}

function lz_tracking_set_geo_span(_timespan)
{
	lz_geo_resolution.SetSpan(_timespan);
}

function lz_tracking_geo_resolute()
{
	if(lz_is_geo_resolution_needed())
	{
		lz_session.GeoResolutions++;
		lz_session.Save();

		lz_geo_resolution.SetStatus(1);
		if(lz_session.GeoResolutions < 4)
		{
			lz_geo_resolution.OnEndEvent = "lz_tracking_geo_result";
			lz_geo_resolution.OnSpanEvent = "lz_tracking_set_geo_span";
			lz_geo_resolution.OnTimeoutEvent = lz_tracking_geo_resolute;
			lz_geo_resolution.ResolveAsync();
		}
		else
			lz_tracking_geo_failure();
		return true;
	}
	else
	{
		lz_geo_resolution.SetStatus(7);
		return false;
	}
}

function lz_tracking_geo_failure()
{
	lz_tracking_set_geo_span(45);
	lz_geo_resolution.SetStatus(4);
	lz_session.GeoResolved = Array('LTUyMg==','LTUyMg==','','','','','');
	lz_session.Save();
	lz_tracking_poll_server();
}

function lz_tracking_action_result(_action,_result,_closeOnClick)
{
	var getValues = "&browid="+lz_global_base64_url_encode(lz_session.BrowserId)+"&url="+lz_global_base64_url_encode(window.location.href);
	getValues += (lz_session.UserId != null) ? "&livezilla="+lz_global_base64_url_encode(lz_session.UserId) : "";

	if(_action=="alert")
		getValues += "&confalert="+lz_alert_active;
	else if(_action=="overlay_box")
		getValues += "&confol="+lz_overlay_active;
	else if(_action=="chat_request")
		getValues += ((!_result) ? "&decreq="+lz_request_active : "&accreq="+lz_request_active);
	else if(_action=="website_push" && _result)
		getValues += "&accwp="+lz_website_push_active;
	else
		getValues += "&decwp="+lz_website_push_active;
		
	if(_closeOnClick)
	{
		getValues += "&clreq=1";
		lz_tracking_close_request();
	}

	lz_tracking_server_request(getValues);
}

function lz_tracking_add_floating_button(_pos,_sh,_shblur,_shx,_shy,_shcolor,_ml,_mt,_mr,_mb,_width,_height)
{
	if (document.all && !window.opera && !window.XMLHttpRequest && typeof document.addEventListener != 'function')
		return;
	var fbdiv = document.getElementById("chat_button_image");
	lz_floating_button = new lz_livebox("lz_floating_button",fbdiv.parentNode.parentNode.innerHTML,_width,_height,_ml,_mt,_mr,_mb,_pos,0,false);
	if(_sh)
		lz_floating_button.lz_livebox_shadow(_shblur,_shx,_shy,'#'+_shcolor);
	lz_floating_button.lz_livebox_show();
	lz_floating_button.lz_livebox_div.style.zIndex = 960;
}

function lz_tracking_add_overlay_box(_olId,_html,_pos,_speed,_slide,_sh,_shblur,_shx,_shy,_shcolor,_ml,_mt,_mr,_mb,_width,_height,_bg,_bgcolor,_bgop)
{
	if(lz_overlay_box == null)
	{
		lz_overlay_active = _olId;
		lz_overlay_box = new lz_livebox("lz_overlay_box",lz_global_base64_decode(_html),_width,_height,_ml,_mt,_mr,_mb,_pos,_speed,_slide);
		if(_sh)
			lz_overlay_box.lz_livebox_shadow(_shblur,_shx,_shy,'#'+_shcolor);
		if(_bg)
			lz_overlay_box.lz_livebox_background('#'+_bgcolor,_bgop);
		lz_overlay_box.lz_livebox_show();
		lz_overlay_box.lz_livebox_div.style.zIndex = 960;
		window.focus();
	}
}

function lz_tracking_request_chat(_reqId,_text,_template,_width,_height,_ml,_mt,_mr,_mb,_position,_speed,_slide,_sh,_shblur,_shx,_shy,_shcolor,_bg,_bgcolor,_bgop)
{
	if(lz_request_window == null)
	{
		_template = (lz_global_base64_decode(_template)).replace("<!--invitation_text-->",(lz_global_base64_decode(_text)));
		lz_request_active = _reqId;
		lz_request_window = new lz_livebox("lz_request_window",_template,_width,_height,_ml,_mt,_mr,_mb,_position,_speed,_slide);
		
		if(_sh)
			lz_request_window.lz_livebox_shadow(_shblur,_shx,_shy,'#'+_shcolor);
		if(_bg)
			lz_request_window.lz_livebox_background('#'+_bgcolor,_bgop);
	
	 	if(lz_request_last != _reqId)
		{
			lz_request_window.lz_livebox_show();
			window.focus();
		}
	}
}var lz_move_active = false;
var lz_move_x,lz_move_y,lz_move_tx,lz_move_ty;
var lz_move_object;
var lz_move_margins;

function lz_livebox(_name,_template,_width,_height,_mleft,_mtop,_mright,_mbottom,_position,_speed,_slide)
{
	this.lz_livebox_slide_finished = false;
	this.lz_livebox_template = _template;
	this.lz_livebox_name = _name;
	this.lz_livebox_move = lz_livebox_move_box;
	this.lz_livebox_show = lz_livebox_show_box;
	this.lz_livebox_shadow = lz_livebox_set_shadow;
	this.lz_livebox_background = lz_livebox_set_background;
	this.lz_livebox_close = lz_livebox_close_box;
	this.lz_livebox_chat = lz_livebox_direct_chat;
	this.lz_livebox_get_left = lz_livebox_center_get_left;
	this.lz_livebox_get_right = lz_livebox_center_get_right;
	this.lz_livebox_get_top = lz_livebox_center_get_top;
	this.lz_livebox_get_bottom = lz_livebox_center_get_bottom;
	this.lz_livebox_div = null;
	this.lz_livebox_shadow_class = null;
	this.lz_livebox_close_button = null;
	this.lz_livebox_background_class = null;
	this.lz_livebox_background_div = null;
	this.lzibst_width = _width;
	this.lzibst_height = _height;
	this.lzibst_margin = lz_move_margins = new Array(_mleft,_mtop,_mright,_mbottom);
	this.lzibst_position = _position;
	this.lzibst_slide_speed = 13;
	this.lzibst_slide_disabled = !_slide;

	if(_speed == 2)
		this.lzibst_slide_step = 3;
	else if(_speed == 1)
		this.lzibst_slide_step = 8;
	else
		this.lzibst_slide_step = 13;

	function lz_livebox_direct_chat(_intid,_groupid)
	{
		var user_header = '';
		var user_email = '';
		var user_company = '';
		var area_code = '';
		var question = '';
		var custom = '';
		var user_name = '';
		var language = '';
		var website = '';
		
		if(document.getElementById('lz_invitation_name') != null && document.getElementById('lz_invitation_name').value.length > 0)
			user_name = lz_global_base64_url_encode(document.getElementById('lz_invitation_name').value);

		var params = "";
		if(user_header.length > 0)
			params += '&eh='+user_header;
		if(user_email.length > 0)
			params += '&ee='+user_email;
		if(user_company.length > 0)
			params += '&ec='+user_company;
		if(area_code.length > 0)
			params += '&code='+area_code;
		if(question.length > 0)
			params += '&eq='+question;
		if(language.length > 0)
			params += '&el='+language;
		if(custom.length > 0)
			params += custom;
		if(website.length > 0)
			params += '&ws='+website;
			
		void(window.open('https://www.mikroe.com/app/webroot/livezilla/chat.php?intid='+_intid+'&en='+user_name+'&intgroup='+_groupid+params,'LiveZilla','width=590,height=725,left=0,top=0,resizable=yes,menubar=no,location=no,status=yes,slidebars=no'));
	}
	
	function lz_livebox_close_box(uid)
	{
		if(this.lz_livebox_background_div != null)
		{
			document.body.removeChild(this.lz_livebox_background_div);
			this.lz_livebox_background_div = null;
		}
		if(!this.lz_livebox_slide_finished)
			return;
		document.body.removeChild(this.lz_livebox_div);
	}
	
	function lz_livebox_set_shadow(_intense,_x,_y,_color)
	{
		this.lz_livebox_shadow_class = document.createElement('STYLE');
		this.lz_livebox_shadow_class.type = 'text/css';
    	var style = document.createTextNode(".livezilla_livebox_shadow_class"+this.lz_livebox_name+"{-moz-box-shadow: "+_x+"px "+_y+"px "+_intense+"px "+_color+";-webkit-box-shadow: "+_x+"px "+_y+"px "+_intense+"px "+_color+";box-shadow: "+_x+"px "+_y+"px "+_intense+"px "+_color+";} ");

		if(this.lz_livebox_shadow_class.styleSheet)
		    this.lz_livebox_shadow_class.styleSheet.cssText = style.nodeValue;
		else 
			this.lz_livebox_shadow_class.appendChild(style);
		document.getElementsByTagName('head')[0].appendChild(this.lz_livebox_shadow_class);
	}
	
	function lz_livebox_set_background(_bgcolor,_bgop)
	{
		if(this.lz_livebox_background_class == null)
		{
			this.lz_livebox_background_class = document.createElement('STYLE');
			this.lz_livebox_background_class.type = 'text/css';
	    	var style = document.createTextNode(".livezilla_livebox_background_class"+this.lz_livebox_name+"{width:100%;height:100%;z-index:950;top:0px;left:0px;position:absolute;filter:alpha(opacity="+(_bgop*100)+"); -moz-opacity:"+_bgop+"; -khtml-opacity: "+_bgop+"; opacity:"+_bgop+";background:"+_bgcolor+";} ");

			if(this.lz_livebox_background_class.styleSheet)
			    this.lz_livebox_background_class.styleSheet.cssText = style.nodeValue;
			else 
				this.lz_livebox_background_class.appendChild(style);
			document.getElementsByTagName('head')[0].appendChild(this.lz_livebox_background_class);

			this.lz_livebox_background_div = document.createElement('DIV');
			this.lz_livebox_background_div.style.position = lz_livebox_get_css_position();
			this.lz_livebox_background_div.className = "livezilla_livebox_background_class"+this.lz_livebox_name;
			document.body.appendChild(this.lz_livebox_background_div);
		}
	}
	
	function lz_livebox_show_box()
	{
		this.lz_livebox_div = document.createElement('DIV');
		
		if(this.lz_livebox_shadow_class != null)
			this.lz_livebox_div.className = "livezilla_livebox_shadow_class"+this.lz_livebox_name;
		
		this.lz_livebox_div.id = this.lz_livebox_name;
		this.lz_livebox_div.style.position = lz_livebox_get_css_position();
		this.lz_livebox_div.style.height = this.lzibst_height+'px';
		this.lz_livebox_div.style.width = this.lzibst_width+'px';
		this.lz_livebox_div.style.zIndex = 1001;
		this.lz_livebox_div.style.cursor = "move";
		this.lz_livebox_div.innerHTML = this.lz_livebox_template.replace("<!--username-->",lz_global_base64_url_decode(""));

		if(this.lzibst_position == 20 || this.lzibst_position == 21 || this.lzibst_position == '22')
			this.lz_livebox_div.style.left = -(this.lzibst_width+100)+'px';
		else
			this.lz_livebox_div.style.top = -(this.lzibst_height+100)+'px';
		document.body.appendChild(this.lz_livebox_div);
		window.setTimeout("window['"+ this.lz_livebox_name +"'].lz_livebox_move()",1);

		document.onmousedown=lz_livebox_init_move;
		document.onmouseup=new Function("lz_move_active=false;");
	}
	
	function lz_livebox_init_move(e) 
	{
		var fobj = !false ? e.target : event.srcElement;
		if(fobj.tagName.toLowerCase() == "input" || fobj.tagName.toLowerCase() == "iframe" || fobj.tagName.toLowerCase() == "a")
			return;
			
		var count = 0;
		while (fobj.style.zIndex != 1001 && count++ < 20)
		{
			fobj = !false ? fobj.parentNode : fobj.parentElement;
			if(!(fobj != null && fobj.className != "unmovable"))
				return;
		}
		
		if (fobj.style.zIndex == 1001)
		{
			fobj.style.position="absolute";
			lz_move_active = true;
			lz_move_object = fobj;

			if(lz_move_object.style.top == '')
				lz_move_object.style.top = ((parseInt((false) ? document.documentElement.offsetHeight : window.innerHeight)-parseInt(lz_move_object.style.height)) - lz_move_margins[3]) + 'px';
			
			if(lz_move_object.style.left == '')
				lz_move_object.style.left = (parseInt((false) ? document.documentElement.offsetWidth : window.innerWidth)-parseInt(lz_move_object.style.width)) + 'px';
				
			lz_move_tx = parseInt(lz_move_object.style.left+0);
			lz_move_ty = parseInt(lz_move_object.style.top+0);
			
			lz_move_x = !false ? e.clientX : event.clientX;
			lz_move_y = !false ? e.clientY : event.clientY;
			document.onmousemove=lz_livebox_process_move;
			return false;
		}
	}
	
	function lz_livebox_process_move(e)
	{
		if (lz_move_active)
		{
			lz_move_object.style.left = ((!false) ? lz_move_tx + e.clientX - lz_move_x : lz_move_tx + event.clientX - lz_move_x) + 'px';
			lz_move_object.style.top  = ((!false) ? lz_move_ty + e.clientY - lz_move_y : lz_move_ty + event.clientY - lz_move_y)+ 'px';
			return false;
		}
	}
	
	function lz_livebox_get_css_position()
	{
		return (lz_global_get_doctype() != "HTML_4" || !false) ? 'fixed' : 'absolute';
	}

	function lz_livebox_move_box()
	{
		this.lz_livebox_div.style.bottom = this.lz_livebox_get_bottom();
		this.lz_livebox_div.style.right = this.lz_livebox_get_right();

		if(this.lzibst_slide_disabled)
		{
			this.lz_livebox_div.style.left = this.lz_livebox_get_left();
			this.lz_livebox_div.style.top = this.lz_livebox_get_top();
			this.lz_livebox_div.style.right = this.lz_livebox_get_right();
			this.lz_livebox_div.style.bottom = this.lz_livebox_get_bottom();
			this.lz_livebox_slide_finished = true;
		}
		else
		{
			if(this.lzibst_position == '20' || this.lzibst_position == '21' || this.lzibst_position == '22')
			{
				var current = parseInt(this.lz_livebox_div.style.left.replace("px","").replace("pt",""));
				current+=this.lzibst_slide_step;

				this.lz_livebox_div.style.left = current+'px';
				this.lz_livebox_div.style.top = this.lz_livebox_get_top();

				var leftdist = parseInt(this.lz_livebox_get_left().replace("px",""));
				if(current < (leftdist-this.lzibst_slide_step))
					window.setTimeout("window['"+ this.lz_livebox_name +"'].lz_livebox_move()",this.lzibst_slide_speed);
				else
				{
					this.lz_livebox_div.style.left = leftdist+'px';
					this.lz_livebox_slide_finished = true;
				}
			}
			else
			{
				var current = parseInt(this.lz_livebox_div.style.top.replace("px","").replace("pt",""));
				current+=this.lzibst_slide_step;
					
				this.lz_livebox_div.style.top = current+'px';
				this.lz_livebox_div.style.left = this.lz_livebox_get_left();
				
				var topdist = parseInt(this.lz_livebox_get_top().replace("px",""));
				if(current < (topdist-this.lzibst_slide_step))
					window.setTimeout("window['"+ this.lz_livebox_name +"'].lz_livebox_move()",this.lzibst_slide_speed);
				else
				{
					this.lz_livebox_div.style.top = topdist+'px';
					this.lz_livebox_slide_finished = true;
				}
			}
		}
		if(this.lz_livebox_slide_finished && document.body.onresize == null)
		{
			if(this.lz_livebox_div.style.position == 'absolute')
				window.onslide = lz_livebox_center_box;
			window.onresize = lz_livebox_center_box;
		}
	}
	
	function lz_livebox_center_get_left()
	{
		var left = 0;
		if(this.lzibst_position == '01' || this.lzibst_position == '11' || this.lzibst_position == '21')
		{
			left  = parseInt((false) ? (document.documentElement.offsetWidth * 50 / 100) : (window.innerWidth * 50 / 100));
			if(this.lz_livebox_div.style.position == 'absolute')
				left += lz_global_get_page_offset_x()
			left -= parseInt(this.lzibst_width / 2);
			
			if(this.lzibst_margin[0] != 0)
				left += this.lzibst_margin[0];
			if(this.lzibst_margin[2] != 0)
				left -= this.lzibst_margin[2];
				
			return left+'px';
		}
		else if(this.lzibst_position == '00' || this.lzibst_position == '10' || this.lzibst_position == '20')
		{
			if(this.lzibst_margin[0] != 0)
				left += this.lzibst_margin[0];
			if(this.lzibst_margin[2] != 0)
				left -= this.lzibst_margin[2];
			
			left+=lz_global_get_page_offset_x();
				
			return left+'px';
		}
		else if(this.lzibst_position == '22')
		{
			left  = parseInt((false) ? (document.documentElement.offsetWidth-this.lzibst_width) : (window.innerWidth-this.lzibst_width));
			if(this.lzibst_margin[0] != 0)
				left += this.lzibst_margin[0];
			if(this.lzibst_margin[2] != 0)
				left -= this.lzibst_margin[2];
				
			left+=lz_global_get_page_offset_x();
				
			return left+'px';
		}
		else
			return '';
	}
	
	function lz_livebox_center_get_right()
	{
		var right = 0;
		if(this.lzibst_position == '02' || this.lzibst_position == '12' || this.lzibst_position == '22')
		{
			if(this.lzibst_margin[0] != 0)
				right -= this.lzibst_margin[0];
			if(this.lzibst_margin[2] != 0)
				right += this.lzibst_margin[2];
				
			right-=lz_global_get_page_offset_x();
				
			return right+'px';
		}
		else
			return '';
	}
	
	function lz_livebox_center_get_top()
	{
		var top = 0;
		if(this.lzibst_position == '10' || this.lzibst_position == '11' || this.lzibst_position == '12')
		{
			top = parseInt((false) ? (document.documentElement.offsetHeight * 50 / 100) : (window.innerHeight * 50 / 100));
			if(this.lz_livebox_div.style.position == 'absolute')
				top += lz_global_get_page_offset_y()
			top -= parseInt(this.lzibst_height / 2);
			
			if(this.lzibst_margin[1] != 0)
				top += this.lzibst_margin[1];
			if(this.lzibst_margin[3] != 0)
				top -= this.lzibst_margin[3];
				
			return parseInt(top)+'px';
		}
		else if(this.lzibst_position == '00' || this.lzibst_position == '01' || this.lzibst_position == '02')
		{
			if(this.lzibst_margin[1] != 0)
				top += this.lzibst_margin[1];
			if(this.lzibst_margin[3] != 0)
				top -= this.lzibst_margin[3];
				
			top+=lz_global_get_page_offset_y();
				
			return parseInt(top)+'px';
		}
		else
		{
			return '';
		}
	}
	
	function lz_livebox_center_get_bottom()
	{
		var bottom = 0;
		if(this.lzibst_position == '20' || this.lzibst_position == '21' || this.lzibst_position == '22')
		{
			if(this.lzibst_margin[1] != 0)
				bottom -= this.lzibst_margin[1];
			if(this.lzibst_margin[3] != 0)
				bottom += this.lzibst_margin[3];
			bottom-=lz_global_get_page_offset_y();
				
			return bottom+'px';
		}
		else
			return '';
	}
}

function lz_livebox_center_box()
{
	if(document.getElementById("lz_request_window") != null)
	{
		document.getElementById("lz_request_window").style.top = window['lz_request_window'].lz_livebox_get_top();
		document.getElementById("lz_request_window").style.left = window['lz_request_window'].lz_livebox_get_left();
		document.getElementById("lz_request_window").style.right = window['lz_request_window'].lz_livebox_get_right();
		document.getElementById("lz_request_window").style.bottom = window['lz_request_window'].lz_livebox_get_bottom();
	}
	if(document.getElementById("lz_alert_window") != null)
	{
		document.getElementById("lz_alert_window").style.top = window['lz_alert_window'].lz_livebox_get_top();
		document.getElementById("lz_alert_window").style.left = window['lz_alert_window'].lz_livebox_get_left();
		document.getElementById("lz_alert_window").style.right = window['lz_alert_window'].lz_livebox_get_right();
		document.getElementById("lz_alert_window").style.bottom = window['lz_alert_window'].lz_livebox_get_bottom();
	}
	if(document.getElementById("lz_floating_button") != null)
	{
		document.getElementById("lz_floating_button").style.top = window['lz_floating_button'].lz_livebox_get_top();
		document.getElementById("lz_floating_button").style.left = window['lz_floating_button'].lz_livebox_get_left();
		document.getElementById("lz_floating_button").style.right = window['lz_floating_button'].lz_livebox_get_right();
		document.getElementById("lz_floating_button").style.bottom = window['lz_floating_button'].lz_livebox_get_bottom();
	}
	if(document.getElementById("lz_overlay_box") != null)
	{
		document.getElementById("lz_overlay_box").style.top = window['lz_overlay_box'].lz_livebox_get_top();
		document.getElementById("lz_overlay_box").style.left = window['lz_overlay_box'].lz_livebox_get_left();
		document.getElementById("lz_overlay_box").style.right = window['lz_overlay_box'].lz_livebox_get_right();
		document.getElementById("lz_overlay_box").style.bottom = window['lz_overlay_box'].lz_livebox_get_bottom();
	}
}